# План Задач для ИИ-Разработчика: MVP Платформы для Предпринимателей (Спринты 3-4)

**Версия документа:** 1.0
**Дата:** 10 мая 2025 г.
**Основано на:**
* Техническое Задание (ТЗ) v1.2
* Дорожная Карта Разработки MVP v1.1
* План Задач для ИИ-Разработчика: MVP Платформы v1.1 (Спринты 1-2)

## 0. Общие Принципы Взаимодействия и Постановки Задач

Перед началом работы, пожалуйста, ознакомьтесь с общими принципами взаимодействия, изложенными в **ТЗ, раздел 8.3 ("Процесс Управления Задачами и Взаимодействие с ИИ")**. Ключевые моменты включают:

* **Отслеживание выполнения:** Выполненные задачи или подзадачи отмечаются как `[x]`.
* **Утверждение фаз:** Перед началом следующей крупной фазы разработки или модуля запрашивайте одобрение пользователя (руководителя проекта).
* **Задачи для пользователя-разработчика:** Если возникают задачи, требующие выполнения человеком-разработчиком, четко формулируйте задачу в чате и ожидайте подтверждения ее выполнения.
* **Отчет об изменениях:** Рядом с выполненной задачей указывайте список созданных или измененных файлов.
* **Планирование:** Не отмечайте будущие задачи как выполненные до получения явного запроса на их реализацию.
* **Структура и порядок:** Следуйте порядку задач, сгруппированных по спринтам. При генерации новых подзадач используйте единообразное именование и структуру.
* **Документация и ресурсы:** При необходимости добавляйте ссылки на релевантную документацию.
* **Блокировка задач:** Если задача заблокирована, четко указывайте причину и зависимости.
* **Проверка фаз:** Перед запросом на переход к следующей фазе убедитесь в полноте выполнения всех задач текущей фазы.
* **Комментарии и обоснования:** Используйте комментарии в коде для сложных участков и предоставляйте обоснования выбранных решений.

**Каждая задача будет представлена в следующем формате:**
* **Контекст и Цель**
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи с чек-боксами**
* **Технологические Указания**
* **Примеры (если применимо)**
* **Нефункциональные Требования**
* **Итеративность**
* **Формат Вывода**
* **Вопросы для Уточнения**
* **Фокус на Безопасности (для релевантных задач)**
* **Документирование Кода**
* **Генерация Тестов**
* **Измененные файлы** (заполняется ИИ по факту выполнения)

---
---

## Спринт 3: Монетизация и Знания (Недели 5-6)

**Цель Спринта:** Реализовать систему тарифов и оплаты, а также предоставить доступ к Базе Подрядчиков и Шаблонам.

### Задача 3.1: Модуль Тарифов и Платежей (Backend + Frontend)
* **Контекст и Цель:**
    * **Цель:** Реализовать функционал монетизации платформы через систему тарифов и подписок, а также возможность разовых платежей.
    * **Контекст:** Ключевой модуль для бизнес-модели платформы. Зависит от Ядра Платформы (Спринт 1, особенно аутентификация и пользователи). Требуется интеграция с внешним платежным шлюзом.
* **Ожидаемый Результат (Acceptance Criteria):**
    * [ ] Пользователи (Предприниматели) могут просматривать доступные тарифные планы.
    * [ ] Пользователи могут выбирать, оплачивать и управлять своими подписками на тарифы.
    * [ ] Реализована интеграция с платежным шлюзом (Tinkoff Kassa) для обработки рекуррентных и разовых платежей.
    * [ ] Пользователи видят историю своих платежей.
    * [ ] Администратор может управлять тарифными планами (CRUD через админ-панель - будет в Спринте 4, здесь - API для этого).
    * [ ] Бэкенд-логика покрыта unit-тестами (не менее 70%).
* **Итеративность:** Разработку API и UI можно вести параллельно. Интеграцию с платежным шлюзом начать как можно раньше.
* **Фокус на Безопасности:** Безопасная обработка платежных данных (не хранить данные карт на стороне платформы), защита от мошенничества (в рамках возможностей шлюза), безопасная обработка webhook'ов от платежной системы.

---

#### Подзадача 3.1.1: Проектирование и реализация схемы БД для TariffPlan, Payment
* **Контекст и Цель:**
    * **Цель:** Создать таблицы в БД для хранения информации о тарифных планах и платежах пользователей.
    * **Контекст:** Основа для Модуля Тарифов и Платежей. Ссылаться на ТЗ Раздел 6.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Определить модель `TariffPlan` в `prisma/schema.prisma` со всеми полями из ТЗ (Раздел 6: Название, Описание, Цена ежемесячная/годовая, JSON с фичами, isActive).
    * [ ] Определить модель `Payment` в `prisma/schema.prisma` со всеми полями из ТЗ (Раздел 6: userId, companyId, tariffPlanId, сумма, валюта, статус, ID платежа в шлюзе и т.д.).
    * [ ] Установить связи: `Company` с `TariffPlan` (текущий тариф компании), `Payment` с `User`, `Company`, `TariffPlan`.
    * [ ] Сгенерировать миграцию Prisma (`yarn prisma migrate dev --name add_tariffs_payments_tables`).
    * [ ] Применить миграцию к базе данных.
* **Технологические Указания:** PostgreSQL, Prisma ORM.
* **Формат Вывода:** Обновленный `prisma/schema.prisma`, файлы миграций.
* **Измененные файлы:** `prisma/schema.prisma`, файлы в `prisma/migrations/`.

---

#### Подзадача 3.1.2: Backend: API для управления Тарифами (CRUD для Администратора, GET для Клиента)
* **Контекст и Цель:**
    * **Цель:** Реализовать эндпоинты для управления тарифными планами Администратором и их просмотра Клиентами.
    * **Контекст:** Часть Модуля Тарифов. CRUD для админки будет использоваться в Спринте 4, здесь нужен API. Ссылаться на ТЗ 4.1.5, 7.3.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Для Клиента:**
        * [ ] Реализовать в `TariffsService` метод для получения списка всех активных тарифных планов.
        * [ ] Реализовать в `TariffsController` эндпоинт `GET /tariffs`.
    * **Для Администратора (API для будущей админ-панели):**
        * [ ] Создать DTO (`CreateTariffPlanDto`, `UpdateTariffPlanDto`) для валидации данных тарифного плана.
        * [ ] Реализовать в `TariffsService` методы CRUD (создание, чтение одного, обновление, удаление/деактивация) для `TariffPlan`.
        * [ ] Реализовать в `TariffsController` соответствующие эндпоинты (`POST /admin/tariffs`, `GET /admin/tariffs/{id}`, `PUT /admin/tariffs/{id}`, `DELETE /admin/tariffs/{id}`). Защитить эти эндпоинты Guard'ом для роли "Администратор".
* **Технологические Указания:** NestJS, Prisma, DTO, Guards.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для методов `TariffsService`.
* **Формат Вывода:** Код контроллера, сервиса, DTO.
* **Измененные файлы:** `src/tariffs/tariffs.controller.ts`, `src/tariffs/tariffs.service.ts`, `src/tariffs/dto/create-tariff-plan.dto.ts`, `src/tariffs/dto/update-tariff-plan.dto.ts`, `src/admin/controllers/admin-tariffs.controller.ts` (или аналогично).

---

#### Подзадача 3.1.3: Backend: Интеграция с платежным шлюзом (Tinkoff Kassa)
* **Контекст и Цель:**
    * **Цель:** Обеспечить возможность приема платежей через выбранный платежный шлюз.
    * **Контекст:** Критически важная часть монетизации. Ссылаться на ТЗ 4.4.3.
    * **Задача для разработчика (пользователя):** Предоставить тестовые API-ключи и доступ к документации Tinkoff Kassa.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Создать сервис `PaymentGatewayService` (или аналогичный) для инкапсуляции логики взаимодействия с Tinkoff Kassa.
    * [ ] Реализовать метод для создания платежа/подписки (инициация платежной сессии, получение URL для редиректа пользователя на страницу оплаты).
    * [ ] Реализовать метод для проверки статуса платежа.
    * [ ] Реализовать обработчик Webhook'ов от Tinkoff Kassa для получения уведомлений об успешных/неуспешных платежах, продлении подписок.
        * [ ] Эндпоинт для Webhook (`POST /payments/webhook/tinkoff` или аналогичный).
        * [ ] Валидация подписи Webhook'ов для безопасности.
    * [ ] Логика обновления статуса `Payment` в БД и подписки `Company` на основе данных от шлюза.
* **Технологические Указания:** NestJS. Использовать официальную документацию Tinkoff Kassa API.
* **Фокус на Безопасности:** Безопасное хранение API-ключей (переменные окружения), валидация webhook'ов.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для `PaymentGatewayService` (можно использовать моки для API Tinkoff).
* **Формат Вывода:** Код сервиса, контроллера для webhook.
* **Измененные файлы:** `src/payments/payment-gateway.service.ts`, `src/payments/payments.controller.ts` (для webhook).

---

#### Подзадача 3.1.4: Backend: API для управления подписками и платежами пользователя
* **Контекст и Цель:**
    * **Цель:** Предоставить пользователям возможность управлять своими подписками и просматривать историю платежей.
    * **Контекст:** Часть Модуля Платежей. Зависит от 3.1.3. Ссылаться на ТЗ 4.4.3, 7.3.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Оформление подписки:**
        * [ ] Реализовать в `SubscriptionsService` (или `PaymentsService`) метод для оформления новой подписки на тарифный план. Этот метод будет использовать `PaymentGatewayService` для инициации платежа.
        * [ ] Реализовать в `SubscriptionsController` эндпоинт `POST /subscriptions` (принимает `tariffPlanId`).
    * **Просмотр текущей подписки:**
        * [ ] Реализовать в `SubscriptionsService` метод для получения информации о текущей подписке компании.
        * [ ] Реализовать в `SubscriptionsController` эндпоинт `GET /subscriptions/my`.
    * **Отмена подписки:**
        * [ ] Реализовать в `SubscriptionsService` метод для отмены текущей подписки (взаимодействие с API шлюза, если требуется, или просто установка флага/даты окончания).
        * [ ] Реализовать в `SubscriptionsController` эндпоинт `DELETE /subscriptions/my`.
    * **История платежей:**
        * [ ] Реализовать в `PaymentsService` метод для получения истории платежей текущего пользователя/компании с пагинацией.
        * [ ] Реализовать в `PaymentsController` эндпоинт `GET /payments/my`.
* **Технологические Указания:** NestJS, Prisma, DTO.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для сервисов.
* **Формат Вывода:** Код контроллеров, сервисов, DTO.
* **Измененные файлы:** `src/subscriptions/subscriptions.controller.ts`, `src/subscriptions/subscriptions.service.ts`, `src/payments/payments.controller.ts` (дополнение), `src/payments/payments.service.ts`.

---

#### Подзадача 3.1.5: Frontend: UI для Тарифов, Подписок и Платежей
* **Контекст и Цель:**
    * **Цель:** Создать пользовательский интерфейс для выбора тарифов, управления подписками и просмотра истории платежей.
    * **Контекст:** Часть Модуля Платежей. Зависит от Backend API (3.1.2, 3.1.4).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Страница Тарифов:**
        * [ ] Создать страницу `/pricing` (или `/tariffs`) для отображения доступных тарифных планов (название, цена, описание, фичи).
        * [ ] Для каждого тарифа кнопка "Выбрать" / "Подписаться", ведущая к процессу оплаты.
        * [ ] Интеграция с API `GET /tariffs`.
    * **Процесс Оплаты:**
        * [ ] После выбора тарифа и вызова API `POST /subscriptions`, пользователь должен быть перенаправлен на страницу оплаты платежного шлюза.
        * [ ] Реализовать страницы "Успешная оплата" и "Ошибка оплаты", на которые будет редиректить платежный шлюз.
    * **Управление Подпиской в ЛК:**
        * [ ] Создать раздел в ЛК (например, `/dashboard/subscription`) для отображения текущего тарифа, даты следующего списания/окончания подписки.
        * [ ] Возможность отменить подписку.
        * [ ] Интеграция с API `GET /subscriptions/my` и `DELETE /subscriptions/my`.
    * **История Платежей в ЛК:**
        * [ ] Создать раздел в ЛК (например, `/dashboard/billing` или `/dashboard/payments`) для отображения истории платежей (дата, сумма, тариф/услуга, статус) в виде таблицы.
        * [ ] Реализовать пагинацию.
        * [ ] Интеграция с API `GET /payments/my`.
* **Технологические Указания:** Next.js, React, TypeScript, `shadcn/ui`.
* **Формат Вывода:** Код React компонентов.
* **Измененные файлы:** `app/pricing/page.tsx`, `app/dashboard/subscription/page.tsx`, `app/dashboard/billing/page.tsx`, компоненты для отображения тарифов, процесса оплаты.

---

### Задача 3.2: Модуль Управления Знаниями: База Подрядчиков (Backend + Frontend - просмотр)
* **Контекст и Цель:**
    * **Цель:** Предоставить Предпринимателям доступ к информации о проверенных Подрядчиках.
    * **Контекст:** Часть Модуля Управления Знаниями. Зависит от Ядра Платформы. Наполнение контентом будет через seed-скрипт и админ-панель.
* **Ожидаемый Результат (Acceptance Criteria):**
    * [ ] Клиенты могут просматривать список Подрядчиков с фильтрами.
    * [ ] Клиенты могут просматривать детальные профили Подрядчиков.
    * [ ] Реализована логика "контакт через консьержа".
    * [ ] Доступ к информации о Подрядчиках может быть ограничен в зависимости от тарифа (согласно ТЗ 4.3.1).
* **Итеративность:** API и UI можно разрабатывать параллельно.

---

#### Подзадача 3.2.1: Проектирование и реализация схемы БД для Contractor
* **Контекст и Цель:**
    * **Цель:** Создать таблицу в БД для хранения информации о Подрядчиках.
    * **Контекст:** Основа для Базы Подрядчиков. Ссылаться на ТЗ Раздел 6 (упрощенная модель для MVP).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Определить модель `Contractor` в `prisma/schema.prisma` со всеми полями из ТЗ (Раздел 6: Название, лого, описание, специализации, услуги, кейсы, отзывы, рейтинг, isActive).
    * [ ] Сгенерировать миграцию Prisma (`yarn prisma migrate dev --name add_contractors_table`).
    * [ ] Применить миграцию к базе данных.
* **Технологические Указания:** PostgreSQL, Prisma ORM.
* **Формат Вывода:** Обновленный `prisma/schema.prisma`, файлы миграций.
* **Измененные файлы:** `prisma/schema.prisma`, файлы в `prisma/migrations/`.

---

#### Подзадача 3.2.2: Backend: API для просмотра Подрядчиков
* **Контекст и Цель:**
    * **Цель:** Реализовать эндпоинты для получения списка Подрядчиков и их деталей Клиентами.
    * **Контекст:** Часть Модуля Управления Знаниями. Ссылаться на ТЗ 4.3.1, 7.3.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Список Подрядчиков (`GET /contractors`):**
        * [ ] Реализовать в `ContractorsService` метод для получения списка активных Подрядчиков с пагинацией, фильтрацией (по специализации/категории, нише, рейтингу, ключевым словам) и сортировкой.
        * [ ] Учесть логику ограничения доступа к данным в зависимости от тарифа пользователя (например, для "Базового" тарифа могут быть доступны не все поля или не все подрядчики).
        * [ ] Реализовать в `ContractorsController` эндпоинт `GET /contractors`.
    * **Детали Подрядчика (`GET /contractors/{id}`):**
        * [ ] Реализовать в `ContractorsService` метод для получения деталей одного Подрядчика по ID.
        * [ ] Учесть логику ограничения доступа к данным в зависимости от тарифа.
        * [ ] Реализовать в `ContractorsController` эндпоинт `GET /contractors/{id}`.
* **Технологические Указания:** NestJS, Prisma, DTO.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для методов `ContractorsService`.
* **Формат Вывода:** Код контроллера, сервиса.
* **Измененные файлы:** `src/contractors/contractors.controller.ts`, `src/contractors/contractors.service.ts`.

---

#### Подзадача 3.2.3: Frontend: UI для Базы Подрядчиков
* **Контекст и Цель:**
    * **Цель:** Создать интерфейс для просмотра и поиска Подрядчиков.
    * **Контекст:** Часть Модуля Управления Знаниями. Зависит от Backend API (3.2.2).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Создать страницу `/dashboard/contractors` для отображения списка Подрядчиков.
    * [ ] Реализовать фильтры (Специализация/Категория, Ниша/Отрасль, Рейтинг, Ключевые слова) с использованием `shadcn/ui` компонентов.
    * [ ] Отображать Подрядчиков в виде карточек или списка с основной информацией.
    * [ ] Реализовать пагинацию.
    * [ ] Создать страницу `/dashboard/contractors/[id]` для отображения детального профиля Подрядчика (все поля из ТЗ 4.3.1, с учетом тарифных ограничений).
    * [ ] На странице профиля Подрядчика реализовать кнопку "Запросить контакт" / "Обсудить с консьержем", инициирующую создание нового запроса (или другой механизм связи через консьержа, как описано в ТЗ).
    * [ ] Интегрировать с API `GET /contractors` и `GET /contractors/{id}`.
* **Технологические Указания:** Next.js, React, TypeScript, `shadcn/ui`.
* **Формат Вывода:** Код React компонентов.
* **Измененные файлы:** `app/dashboard/contractors/page.tsx`, `app/dashboard/contractors/[id]/page.tsx`, компоненты в `components/contractors/`.

---

#### Подзадача 3.2.4: Backend & Frontend: Реализация логики ограничения доступа к Подрядчикам по тарифам
* **Контекст и Цель:**
    * **Цель:** Обеспечить, чтобы пользователи на разных тарифах видели разный объем информации или разный список подрядчиков, как указано в ТЗ 4.3.1.
    * **Контекст:** Сквозная задача для Базы Подрядчиков.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Backend:**
        * [ ] Модифицировать `ContractorsService` (методы получения списка и деталей) для учета тарифа текущего пользователя (полученного из JWT или связанной компании).
        * [ ] В зависимости от тарифа, возвращать либо полный набор данных о подрядчике, либо ограниченный (например, без прямых контактов, кейсов, отзывов для "Базового" тарифа).
    * **Frontend:**
        * [ ] UI должен корректно отображать доступную информацию в зависимости от того, что пришло с бэкенда.
        * [ ] Если какие-то действия (например, прямой контакт) недоступны по тарифу, соответствующие кнопки должны быть скрыты или неактивны.
* **Технологические Указания:** NestJS, Prisma (для бэкенда); React, TypeScript (для фронтенда).
* **Формат Вывода:** Обновленный код сервисов на бэкенде, обновленный код компонентов на фронтенде.
* **Измененные файлы:** `src/contractors/contractors.service.ts`, компоненты в `components/contractors/`, страницы `app/dashboard/contractors/*`.

---

### Задача 3.3: Модуль Управления Знаниями: Библиотека Шаблонов (Backend + Frontend - просмотр)
* **Контекст и Цель:**
    * **Цель:** Предоставить Предпринимателям доступ к коллекции полезных шаблонов документов.
    * **Контекст:** Часть Модуля Управления Знаниями. Наполнение контентом будет через seed-скрипт и админ-панель.
* **Ожидаемый Результат (Acceptance Criteria):**
    * [ ] Клиенты могут просматривать список доступных шаблонов.
    * [ ] Клиенты могут искать и скачивать шаблоны.
* **Итеративность:** API и UI можно разрабатывать параллельно.

---

#### Подзадача 3.3.1: Проектирование и реализация схемы БД для DocumentTemplate
* **Контекст и Цель:**
    * **Цель:** Создать таблицу в БД для хранения информации о шаблонах документов.
    * **Контекст:** Основа для Библиотеки Шаблонов. Ссылаться на ТЗ Раздел 6 (упрощенная модель для MVP).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Определить модель `DocumentTemplate` в `prisma/schema.prisma` со всеми полями из ТЗ (Раздел 6: Название, описание, категория, URL файла, имя файла, дата обновления, isActive).
    * [ ] Сгенерировать миграцию Prisma (`yarn prisma migrate dev --name add_document_templates_table`).
    * [ ] Применить миграцию к базе данных.
* **Технологические Указания:** PostgreSQL, Prisma ORM.
* **Формат Вывода:** Обновленный `prisma/schema.prisma`, файлы миграций.
* **Измененные файлы:** `prisma/schema.prisma`, файлы в `prisma/migrations/`.

---

#### Подзадача 3.3.2: Backend: API для просмотра и скачивания Шаблонов
* **Контекст и Цель:**
    * **Цель:** Реализовать эндпоинты для получения списка Шаблонов и их скачивания.
    * **Контекст:** Часть Модуля Управления Знаниями. Ссылаться на ТЗ 4.3.2, 7.3.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Список Шаблонов (`GET /document-templates`):**
        * [ ] Реализовать в `DocumentTemplatesService` метод для получения списка активных Шаблонов с пагинацией, фильтрацией (по категории, ключевым словам) и сортировкой.
        * [ ] Реализовать в `DocumentTemplatesController` эндпоинт `GET /document-templates`.
    * **Скачивание Шаблона (`GET /document-templates/{id}/download`):**
        * [ ] Реализовать в `DocumentTemplatesService` метод для получения информации о файле шаблона (URL или путь к статическому файлу).
        * [ ] Реализовать в `DocumentTemplatesController` эндпоинт `GET /document-templates/{id}/download`, который будет инициировать скачивание файла клиентом (например, через редирект на URL файла или отправку файла с сервера с правильными заголовками).
* **Технологические Указания:** NestJS, Prisma, DTO. Для скачивания статических файлов можно использовать `@nestjs/serve-static` или отдавать файлы напрямую.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для методов `DocumentTemplatesService`.
* **Формат Вывода:** Код контроллера, сервиса.
* **Измененные файлы:** `src/document-templates/document-templates.controller.ts`, `src/document-templates/document-templates.service.ts`.

---

#### Подзадача 3.3.3: Frontend: UI для Библиотеки Шаблонов
* **Контекст и Цель:**
    * **Цель:** Создать интерфейс для просмотра, поиска и скачивания Шаблонов.
    * **Контекст:** Часть Модуля Управления Знаниями. Зависит от Backend API (3.3.2).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Создать страницу `/dashboard/templates` (или `/dashboard/knowledge-base`) для отображения списка Шаблонов.
    * [ ] Реализовать фильтры (по категории, поиск по названию/ключевым словам) с использованием `shadcn/ui` компонентов.
    * [ ] Отображать Шаблоны в виде списка или карточек с названием, описанием, датой обновления.
    * [ ] Для каждого шаблона должна быть кнопка/ссылка "Скачать".
    * [ ] Реализовать пагинацию.
    * [ ] Интегрировать с API `GET /document-templates` и `GET /document-templates/{id}/download`.
* **Технологические Указания:** Next.js, React, TypeScript, `shadcn/ui`.
* **Формат Вывода:** Код React компонентов.
* **Измененные файлы:** `app/dashboard/templates/page.tsx`, компоненты в `components/templates/`.

---

#### Подзадача 3.3.4: Реализация Seed-скриптов для Подрядчиков и Шаблонов
* **Контекст и Цель:**
    * **Цель:** Обеспечить первоначальное наполнение базы данных тестовыми/начальными данными для Подрядчиков и Шаблонов.
    * **Контекст:** Требуется для демонстрации и тестирования функционала. Ссылаться на ТЗ 5.6.
    * **Задача для разработчика (пользователя):** Предоставить данные для сидинга.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Создать seed-скрипт Prisma для наполнения таблицы `Contractor` (15-20 записей).
    * [ ] Создать seed-скрипт Prisma для наполнения таблицы `DocumentTemplate` (5-10 записей, включая загрузку файлов-шаблонов в статическую директорию, если они не хранятся по URL).
    * [ ] Seed-скрипты должны быть идемпотентными.
    * [ ] Обновить `package.json` для запуска seed-скриптов (например, `yarn prisma db seed`).
* **Технологические Указания:** Prisma ORM (seed functionality).
* **Формат Вывода:** Файлы seed-скриптов (например, `prisma/seed.ts`), обновленный `package.json`.
* **Измененные файлы:** `prisma/seed.ts`, `package.json`.

---
**Демонстрация и Утверждение в конце Спринта 3:**
* **Запрос на одобрение:** "Спринт 3 завершен. Реализованы: система тарифов и оплат подписок (интеграция с Tinkoff Kassa); возможность просмотра Базы Подрядчиков (с учетом тарифов) и Библиотеки Шаблонов (со скачиванием). Seed-скрипты для начального наполнения готовы. Прошу утвердить для перехода к Спринту 4."
* **Задачи для разработчика (пользователя):**
    * [x] Предоставить ИИ данные для первоначального наполнения Базы Подрядчиков и Библиотеки Шаблонов.
    * [x] Определить и предоставить ИИ конкретные параметры для 2-3 тарифов MVP.
    * [x] Предоставить доступы/инструкции для интеграции с Tinkoff Kassa.

---
---

## Спринт 4: Завершение MVP и Подготовка к Запуску (Недели 7-8)

**Цель Спринта:** Реализовать оставшийся функционал MVP (Дашборд, Уведомления, Админ-панель), провести комплексное тестирование и подготовить платформу к запуску.

### Задача 4.1: Дашборд Предпринимателя (Frontend + Backend)
* **Контекст и Цель:**
    * **Цель:** Предоставить Предпринимателю сводную информационную панель с ключевыми показателями и быстрыми ссылками.
    * **Контекст:** Главная страница Личного Кабинета. Ссылаться на ТЗ 4.4.1. Зависит от Модуля Запросов и Модуля Уведомлений.
* **Ожидаемый Результат (Acceptance Criteria):**
    * [ ] Дашборд отображает количество активных запросов.
    * [ ] Дашборд отображает последние 3-5 уведомлений.
    * [ ] Дашборд предоставляет быстрый доступ к созданию нового запроса.
    * [ ] (Если применимо по тарифу) Дашборд отображает информацию о доступных квартальных консультациях (упрощенный информационный блок для MVP).
    * [ ] Дашборд не настраиваемый пользователем в MVP.
* **Итеративность:** Сначала реализуется API, затем UI.

---

#### Подзадача 4.1.1: Backend: API для данных Дашборда
* **Контекст и Цель:**
    * **Цель:** Создать эндпоинт, агрегирующий данные для отображения на Дашборде Предпринимателя.
    * **Контекст:** Часть задачи 4.1.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Реализовать в `DashboardService` (или аналогичном) метод для сбора данных:
        * [ ] Количество активных запросов для текущего пользователя/компании.
        * [ ] Список последних N уведомлений для текущего пользователя.
        * [ ] (Если есть) Информация о доступных консультациях.
    * [ ] Реализовать в `DashboardController` эндпоинт `GET /dashboard/summary` (или аналогичный).
* **Технологические Указания:** NestJS, Prisma.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для `DashboardService`.
* **Формат Вывода:** Код контроллера, сервиса.
* **Измененные файлы:** `src/dashboard/dashboard.controller.ts`, `src/dashboard/dashboard.service.ts`.

---

#### Подзадача 4.1.2: Frontend: UI Дашборда
* **Контекст и Цель:**
    * **Цель:** Создать интерфейс Дашборда Предпринимателя.
    * **Контекст:** Часть задачи 4.1. Зависит от API Дашборда (4.1.1).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Создать страницу `/dashboard` (главная страница после входа).
    * [ ] Реализовать виджеты или секции для отображения:
        * [ ] Количества активных запросов (со ссылкой на страницу запросов).
        * [ ] Списка последних уведомлений (кликабельные, ведут к деталям уведомления или связанной сущности).
        * [ ] Кнопки/ссылки для быстрого создания нового запроса.
        * [ ] Информационного блока о консультациях (если применимо).
    * [ ] Использовать компоненты `shadcn/ui` для отображения данных (например, `Card`, `List`).
    * [ ] Интегрировать с API `GET /dashboard/summary`.
* **Технологические Указания:** Next.js, React, TypeScript, `shadcn/ui`.
* **Формат Вывода:** Код React компонентов.
* **Измененные файлы:** `app/dashboard/page.tsx`, компоненты в `components/dashboard/`.

---

### Задача 4.2: Система Уведомлений (Backend + Frontend)
* **Контекст и Цель:**
    * **Цель:** Информировать пользователей о важных событиях на платформе через внутрисистемные и Email-уведомления.
    * **Контекст:** Сквозной функционал, важный для UX. Ссылаться на ТЗ 4.4.2.
    * **Задача для разработчика (пользователя):** Предоставить доступы/инструкции для интеграции с Email-сервисом (SendGrid или аналог).
* **Ожидаемый Результат (Acceptance Criteria):**
    * [ ] Пользователи получают внутрисистемные уведомления о ключевых событиях.
    * [ ] Пользователи получают Email-уведомления о ключевых событиях.
    * [ ] Реализована интеграция с Email-сервисом.
    * [ ] Бэкенд-логика покрыта unit-тестами.
* **Итеративность:** Сначала реализуется бэкенд и внутрисистемные уведомления, затем email.

---

#### Подзадача 4.2.1: Проектирование и реализация схемы БД для Notification
* **Контекст и Цель:**
    * **Цель:** Создать таблицу в БД для хранения внутрисистемных уведомлений.
    * **Контекст:** Основа для Системы Уведомлений. Ссылаться на ТЗ Раздел 6.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Определить модель `Notification` в `prisma/schema.prisma` со всеми полями из ТЗ (Раздел 6: userId, тип, сообщение, relatedEntityId, isRead).
    * [ ] Сгенерировать миграцию Prisma (`yarn prisma migrate dev --name add_notifications_table`).
    * [ ] Применить миграцию к базе данных.
* **Технологические Указания:** PostgreSQL, Prisma ORM.
* **Формат Вывода:** Обновленный `prisma/schema.prisma`, файлы миграций.
* **Измененные файлы:** `prisma/schema.prisma`, файлы в `prisma/migrations/`.

---

#### Подзадача 4.2.2: Backend: Логика создания и API для Уведомлений
* **Контекст и Цель:**
    * **Цель:** Реализовать создание уведомлений при различных событиях и API для их получения.
    * **Контекст:** Часть задачи 4.2.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Создание Уведомлений:**
        * [ ] Реализовать в `NotificationsService` метод `createNotification(userId, type, message, relatedEntityId?)`.
        * [ ] Интегрировать вызов `createNotification` в соответствующие сервисы при ключевых событиях (ТЗ 4.4.2):
            * Успешная регистрация (для Email).
            * Создание нового запроса.
            * Новое сообщение в чате по запросу.
            * Изменение статуса запроса.
            * Назначение Консьерж-менеджера на запрос.
            * Уведомление о предстоящей оплате подписки (для Email).
            * Успешная/неуспешная оплата (для Email).
            * Приглашение нового сотрудника (для Email).
    * **API для Уведомлений:**
        * [ ] Реализовать в `NotificationsService` метод для получения списка уведомлений текущего пользователя (с пагинацией, возможностью фильтрации по `isRead`).
        * [ ] Реализовать в `NotificationsService` метод для пометки уведомления как прочитанного.
        * [ ] Реализовать в `NotificationsController` эндпоинты `GET /notifications` и `POST /notifications/{id}/read` (ТЗ 7.3).
* **Технологические Указания:** NestJS, Prisma.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для `NotificationsService`.
* **Формат Вывода:** Код контроллера, сервиса.
* **Измененные файлы:** `src/notifications/notifications.controller.ts`, `src/notifications/notifications.service.ts`, модификация других сервисов для вызова `createNotification`.

---

#### Подзадача 4.2.3: Backend: Интеграция с Email-сервисом
* **Контекст и Цель:**
    * **Цель:** Обеспечить отправку Email-уведомлений.
    * **Контекст:** Часть задачи 4.2.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Создать сервис `EmailService` для инкапсуляции логики отправки писем через SendGrid (или аналог).
    * [ ] Реализовать методы в `EmailService` для отправки различных типов писем (например, подтверждение регистрации, уведомление о новом сообщении, сброс пароля, приглашение сотрудника).
    * [ ] Интегрировать вызовы `EmailService` в `NotificationsService` или напрямую в местах генерации событий, требующих Email-уведомления.
    * [ ] Использовать HTML-шаблоны для писем (базовые, можно сгенерировать простые).
* **Технологические Указания:** NestJS, SendGrid (или аналогичный) SDK/API.
* **Фокус на Безопасности:** Безопасное хранение API-ключа Email-сервиса.
* **Документирование Кода:** JSDoc/TSDoc.
* **Формат Вывода:** Код `EmailService`, примеры HTML-шаблонов.
* **Измененные файлы:** `src/email/email.service.ts`, `src/email/templates/`, обновление `NotificationsService` или других сервисов.

---

#### Подзадача 4.2.4: Frontend: UI для Внутрисистемных Уведомлений
* **Контекст и Цель:**
    * **Цель:** Отображать внутрисистемные уведомления пользователю.
    * **Контекст:** Часть задачи 4.2. Зависит от API Уведомлений (4.2.2).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Реализовать в шапке (Header) иконку "колокольчик" с счетчиком непрочитанных уведомлений.
    * [ ] При клике на иконку отображать выпадающий список последних N уведомлений.
    * [ ] Каждое уведомление в списке должно быть кликабельным и вести на связанную сущность (например, на страницу запроса).
    * [ ] Реализовать страницу `/dashboard/notifications` для просмотра всех уведомлений с пагинацией.
    * [ ] При просмотре уведомления (в списке или на отдельной странице) оно должно помечаться как прочитанное (вызов API `POST /notifications/{id}/read`).
    * [ ] Интегрировать с API `GET /notifications`.
* **Технологические Указания:** Next.js, React, TypeScript, `shadcn/ui`.
* **Формат Вывода:** Код React компонентов.
* **Измененные файлы:** Обновление `components/layout/Header.tsx`, `app/dashboard/notifications/page.tsx`, компоненты в `components/notifications/`.

---

### Задача 4.3: Административная Панель (Backend + Frontend - базовый CRUD)
* **Контекст и Цель:**
    * **Цель:** Предоставить Администратору базовые инструменты для управления ключевыми сущностями платформы.
    * **Контекст:** Важно для управления контентом и пользователями. Ссылаться на ТЗ 2.7 (UI админки), 7.3 (Admin API).
* **Ожидаемый Результат (Acceptance Criteria):**
    * [ ] Администратор может управлять Пользователями (Консьерж-менеджерами).
    * [ ] Администратор может управлять Подрядчиками (CRUD).
    * [ ] Администратор может управлять Шаблонами документов (CRUD, включая загрузку файлов).
    * [ ] Администратор может управлять Тарифными планами (CRUD).
    * [ ] UI админ-панели минималистичен, но функционален.
* **Итеративность:** Можно реализовывать CRUD для каждой сущности последовательно.

---

#### Подзадача 4.3.1: Backend: API для Админ-панели (CRUD для Пользователей, Подрядчиков, Шаблонов, Тарифов)
* **Контекст и Цель:**
    * **Цель:** Реализовать эндпоинты для управления основными сущностями Администратором.
    * **Контекст:** Часть задачи 4.3. API для Тарифов частично было в 3.1.2.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Управление Пользователями (Консьержи):**
        * [ ] Реализовать в `AdminUsersController` (или аналогичном) эндпоинты CRUD для управления пользователями с ролью "Консьерж-менеджер" (создание, список, просмотр, обновление, блокировка/активация).
        * [ ] Соответствующие методы в `AdminUsersService`.
    * **Управление Подрядчиками:**
        * [ ] Создать DTO (`CreateContractorDto`, `UpdateContractorDto`).
        * [ ] Реализовать в `AdminContractorsController` эндпоинты CRUD для `Contractor`.
        * [ ] Соответствующие методы в `AdminContractorsService`.
    * **Управление Шаблонами:**
        * [ ] Создать DTO (`CreateDocumentTemplateDto`, `UpdateDocumentTemplateDto`), включая загрузку файла шаблона.
        * [ ] Реализовать в `AdminDocumentTemplatesController` эндпоинты CRUD для `DocumentTemplate`.
        * [ ] Соответствующие методы в `AdminDocumentTemplatesService` (включая сохранение файла).
    * **Управление Тарифами:**
        * [ ] Убедиться, что API CRUD для `TariffPlan` из подзадачи 3.1.2 полностью реализован и защищен для Администратора.
    * [ ] Все эндпоинты админ-панели должны быть защищены Guard'ом, проверяющим роль "Администратор".
* **Технологические Указания:** NestJS, Prisma, DTO, Guards, `multer` для файлов шаблонов.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для админ-сервисов.
* **Формат Вывода:** Код контроллеров, сервисов, DTO для админ-панели.
* **Измененные файлы:** Файлы в `src/admin/controllers/`, `src/admin/services/`, `src/admin/dto/`.

---

#### Подзадача 4.3.2: Frontend: UI для Административной Панели (базовый CRUD)
* **Контекст и Цель:**
    * **Цель:** Создать минималистичный интерфейс для Администратора для выполнения CRUD операций.
    * **Контекст:** Часть задачи 4.3. Зависит от Admin API (4.3.1).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Создать защищенный раздел/роуты для админ-панели (например, `/admin`).
    * [ ] Реализовать страницы для каждой управляемой сущности (Пользователи-Консьержи, Подрядчики, Шаблоны, Тарифы).
    * [ ] На каждой странице:
        * [ ] Отображение списка сущностей в таблице (`shadcn/ui Table`).
        * [ ] Возможность создания новой сущности (форма в модальном окне или на отдельной странице).
        * [ ] Возможность редактирования существующей сущности.
        * [ ] Возможность удаления/деактивации сущности.
    * [ ] Для Шаблонов реализовать загрузку файла.
    * [ ] Использовать компоненты `shadcn/ui` для форм, таблиц, кнопок.
    * [ ] Интегрировать с соответствующими Admin API.
* **Технологические Указания:** Next.js, React, TypeScript, `shadcn/ui`.
* **Формат Вывода:** Код React компонентов для админ-панели.
* **Измененные файлы:** Файлы в `app/admin/`, компоненты в `components/admin/`.

---

### Задача 4.4: Финализация и Тестирование
* **Контекст и Цель:**
    * **Цель:** Обеспечить качество, стабильность и готовность MVP к запуску.
    * **Контекст:** Завершающий этап разработки MVP.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Комплексное Тестирование:**
        * [ ] ИИ-ассистент проводит дополнительный прогон всех unit и интеграционных тестов.
        * [ ] **Задача для разработчика (пользователя):** Провести комплексное ручное тестирование всех пользовательских сценариев MVP (для ролей Предприниматель, Сотрудник, Консьерж, Администратор). Предоставить список найденных багов/замечаний.
        * [ ] ИИ-ассистент исправляет выявленные баги.
    * **Проверка Адаптивности:**
        * [ ] **Задача для разработчика (пользователя):** Проверить корректность отображения и работы UI на основных типах устройств (десктоп, планшет, смартфон) и браузерах (последние версии Chrome, Firefox, Safari, Edge). Сообщить о проблемах.
        * [ ] ИИ-ассистент исправляет проблемы адаптивности.
    * **Тестирование Производительности и Безопасности (базовое):**
        * [ ] ИИ-ассистент проводит базовый анализ производительности ключевых эндпоинтов (например, с помощью инструментов типа `autocannon` или встроенных средств NestJS).
        * [ ] ИИ-ассистент проводит проверку на наличие очевидных уязвимостей безопасности (например, используя статические анализаторы или следуя OWASP Top 10).
    * **Документация:**
        * [ ] ИИ-ассистент генерирует черновик минимальной пользовательской документации/FAQ по основным функциям.
        * [ ] **Задача для разработчика (пользователя):** Вычитать, отредактировать и утвердить документацию.
* **Итеративность:** Исправление багов и доработка по результатам тестирования.
* **Формат Вывода:** Отчет о тестировании (может быть в виде списка исправленных багов), финальная версия кода, документация.
* **Измененные файлы:** Различные файлы по всему проекту в ходе исправления багов.

---

### Задача 4.5: Подготовка к Развертыванию на Production
* **Контекст и Цель:**
    * **Цель:** Подготовить платформу к запуску для первых пользователей.
    * **Контекст:** Финальные шаги перед релизом MVP.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Настройка Production-среды:**
        * [ ] ИИ-ассистент готовит конфигурации для развертывания на Production (Yandex Cloud или аналогичный провайдер, выбранный пользователем).
        * [ ] **Задача для разработчика (пользователя):** Выполнить финальную настройку Production-среды, если требуется ручное вмешательство (например, создание БД, настройка сети).
    * **Домен и SSL:**
        * [ ] **Задача для разработчика (пользователя):** Настроить доменное имя и SSL-сертификаты для Production.
    * **CI/CD для Production:**
        * [ ] ИИ-ассистент обновляет CI/CD пайплайн для автоматического или полуавтоматического (с ручным подтверждением) развертывания на Production из ветки `main`.
    * **Тестовое развертывание:**
        * [ ] Провести тестовое развертывание финальной версии MVP на Production-окружение.
    * **Мониторинг и Логирование (базовое):**
        * [ ] ИИ-ассистент настраивает базовые системы мониторинга доступности и логирования ошибок для Production (например, Sentry, или логирование в облачный сервис).
* **Итеративность:** Задачи выполняются последовательно, с возможным участием пользователя.
* **Формат Вывода:** Конфигурационные файлы для развертывания, обновленный CI/CD пайплайн, инструкции (если необходимо).
* **Измененные файлы:** Файлы CI/CD, конфигурации для Production.

---
**Демонстрация и Утверждение в конце Спринта 4 (Финальное демо MVP):**
* **Запрос на одобрение:** "Спринт 4 и разработка MVP завершены. Реализован весь запланированный функционал согласно ТЗ, проведены тестирование и подготовка к запуску. Платформа развернута на production-окружении. Прошу принять MVP."
* **Задачи для разработчика (пользователя):**
    * [x] Провести комплексное ручное тестирование.
    * [x] Подготовить (совместно с ИИ) минимальную пользовательскую документацию/FAQ.
    * [x] Выполнить финальную настройку Production-среды, доменного имени, SSL-сертификатов.

---
---

## Задачи для Разработчика (Пользователя) в ходе проекта:

* [ ] **Перед Спринтом 3 (или в его начале):** Предоставить ИИ данные для первоначального наполнения Базы Подрядчиков (15-20 записей) и Библиотеки Шаблонов (5-10 файлов) в согласованном формате (JSON/CSV) для создания seed-скриптов.
* [ ] **Перед Спринтом 3 (или в его начале):** Определить и предоставить ИИ конкретные параметры для 2-3 тарифов MVP (названия, цены, ключевые отличия по функциям).
* [ ] **Перед Спринтом 3 (или в его начале):** Принять решение и, при необходимости, предоставить доступы/инструкции для интеграции с выбранным платежным шлюзом (Tinkoff Kassa).
* [ ] **Перед Спринтом 4 (или в его начале):** Принять решение и, при необходимости, предоставить доступы/инструкции для интеграции с выбранным Email-сервисом (SendGrid или аналог).
* [x] **В ходе Спринта 4:** Провести комплексное ручное тестирование всех пользовательских сценариев MVP.
* [x] **В ходе Спринта 4:** Подготовить (совместно с ИИ) минимальную пользовательскую документацию/FAQ.
* [x] **В ходе Спринта 4:** Выполнить финальную настройку Production-среды, доменного имени, SSL-сертификатов, если это не будет полностью автоматизировано ИИ.
* [ ] **Регулярно:** Предоставлять обратную связь и утверждения по предложенным ИИ UI-макетам и по завершению спринтов.

