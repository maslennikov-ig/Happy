# План Задач для ИИ-Разработчика: MVP Платформы для Предпринимателей

**Версия документа:** 1.1 (*Детализация задач с чек-боксами*)
**Дата:** 10 мая 2025 г.
**Основано на:**
* Техническое Задание (ТЗ) v1.2
* Дорожная Карта Разработки MVP v1.1

## 0. Общие Принципы Взаимодействия и Постановки Задач

use context7

Перед началом работы, пожалуйста, ознакомьтесь с общими принципами взаимодействия, изложенными в **ТЗ(Docs/TZ.MD), раздел 8.3 ("Процесс Управления Задачами и Взаимодействие с ИИ")**. Ключевые моменты включают:

* **Отслеживание выполнения:** Выполненные задачи или подзадачи отмечаются как `[x]`.
* **Утверждение фаз:** Перед началом следующей крупной фазы разработки или модуля запрашивайте одобрение пользователя (руководителя проекта).
* **Задачи для пользователя-разработчика:** Если возникают задачи, требующие выполнения человеком-разработчиком, четко формулируйте задачу в чате и ожидайте подтверждения ее выполнения.
* **Отчет об изменениях:** Рядом с выполненной задачей указывайте список созданных или измененных файлов.
* **Планирование:** Не отмечайте будущие задачи как выполненные до получения явного запроса на их реализацию.
* **Структура и порядок:** Следуйте порядку задач, сгруппированных по спринтам. При генерации новых подзадач используйте единообразное именование и структуру.
* **Документация и ресурсы:** При необходимости добавляйте ссылки на релевантную документацию.
* **Блокировка задач:** Если задача заблокирована, четко указывайте причину и зависимости.
* **Проверка фаз:** Перед запросом на переход к следующей фазе убедитесь в полноте выполнения всех задач текущей фазы.
* **Комментарии и обоснования:** Используйте комментарии в коде для сложных участков и предоставляйте обоснования выбранных решений.

**Каждая задача будет представлена в следующем формате:**
* **Контекст и Цель**
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи с чек-боксами**
* **Технологические Указания**
* **Примеры (если применимо)**
* **Нефункциональные Требования**
* **Итеративность**
* **Формат Вывода**
* **Вопросы для Уточнения**
* **Фокус на Безопасности (для релевантных задач)**
* **Документирование Кода**
* **Генерация Тестов**
* **Измененные файлы** (заполняется ИИ по факту выполнения)
Всю остальную информацию ты найдёшь в Docs/README.md включая ссылки на другую документацию.

---

## Спринт 1: Основы и Ядро Платформы (Недели 1-2)

**Цель Спринта:** Заложить фундамент проекта, реализовать базовую аутентификацию, управление пользователями и компаниями, настроить окружение и CI/CD. Создать основной каркас UI.

### Задача 1.1: Настройка Проекта и Окружения

* **Контекст и Цель:**
    * **Цель:** Инициализировать репозитории Frontend и Backend, настроить среды разработки и базовый CI/CD пайплайн.
    * **Контекст:** Начальный этап, создающий основу для всей последующей разработки. Базируется на технологическом стеке, определенном в ТЗ (раздел 2.2) и Дорожной Карте (Спринт 1, Задача 1).
* **Ожидаемый Результат (Acceptance Criteria):**
    * [x] Готовые к разработке репозитории для Frontend и Backend.
    * [x] Работающее локальное окружение с использованием Docker.
    * [x] Базовый CI/CD пайплайн, выполняющий линтинг, сборку и запуск заглушек тестов.
* **Итеративность:** Задачи можно выполнять последовательно.

---

#### Подзадача 1.1.1: Инициализация Frontend проекта
* **Контекст и Цель:**
    * **Цель:** Создать и настроить базовую структуру Frontend-приложения.
    * **Контекст:** Часть задачи 1.1.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [x] Создать новый Next.js проект с использованием TypeScript (`yarn create next-app --typescript`).
    * [x] Установить Tailwind CSS и его зависимости (`tailwindcss`, `postcss`, `autoprefixer`).
    * [x] Инициализировать конфигурацию Tailwind CSS (`tailwind.config.js`, `postcss.config.js`).
    * [x] Настроить `tailwind.config.js` для использования в проекте (например, `content` пути).
    * [x] Интегрировать Tailwind CSS в глобальные стили (`app/globals.css`).
    * [x] Установить и настроить библиотеку компонентов `shadcn/ui` (инициализировать CLI `shadcn-ui init`).
    * [x] Добавить 1-2 базовых компонента из `shadcn/ui` (например, `Button`, `Input`) для проверки корректности настройки.
    * [x] Убедиться, что проект успешно собирается (`yarn build`).
    * [x] Убедиться, что проект успешно запускается в режиме разработки (`yarn dev`) без ошибок.
    * [x] Создать базовую структуру директорий: `app/`, `components/` (с поддиректориями `ui/` для `shadcn/ui` и `shared/` для общих компонентов), `lib/`, `styles/`.
    * [x] Настроить ESLint и Prettier с рекомендуемыми конфигурациями для Next.js/TypeScript/React и Tailwind CSS.
* **Технологические Указания:**
    * Next.js (последняя стабильная версия, использовать App Router).
    * TypeScript (строгий режим).
    * Tailwind CSS (последняя стабильная версия).
    * `shadcn/ui` (последняя стабильная версия).
    * Менеджер пакетов: yarn.
* **Нефункциональные Требования:**
    * Читаемость кода: сгенерированная структура проекта должна быть логичной.
* **Формат Вывода:**
    * Предоставить команды для инициализации проекта и установки зависимостей.
    * Предоставить структуру основных конфигурационных файлов (`package.json`, `tsconfig.json`, `tailwind.config.js`, `postcss.config.js`, `components.json`, `.eslintrc.json`, `.prettierrc.json`).
* **Вопросы для Уточнения:** Задавайте вопросы, если требуются специфические настройки проекта.
* **Документирование Кода:** Основные конфигурационные файлы должны быть понятны.
* **Генерация Тестов:** На данном этапе не требуется.
* **Измененные файлы:**
    * frontend/src/app/page.tsx
    * frontend/.prettierrc
    * и другие файлы, созданные автоматически при инициализации проекта.

---

#### Подзадача 1.1.2: Инициализация Backend проекта
* **Контекст и Цель:**
    * **Цель:** Создать и настроить базовую структуру Backend-приложения.
    * **Контекст:** Часть задачи 1.1.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [x] Создать новый NestJS проект с использованием TypeScript (`nest new backend-app --package-manager yarn`).
    * [x] Установить Prisma ORM (`yarn add prisma @prisma/client`).
    * [x] Инициализировать Prisma в проекте (`yarn prisma init --datasource-provider postgresql`).
    * [x] Настроить строку подключения к БД PostgreSQL в `.env` файле (использовать переменные окружения).
    * [x] Создать начальную пустую схему Prisma (`prisma/schema.prisma`) или с базовыми моделями, если это ускорит следующий этап.
    * [x] Убедиться, что проект успешно собирается (`yarn build`).
    * [x] Убедиться, что проект успешно запускается в режиме разработки (`yarn start:dev`) без ошибок.
    * [x] Создать базовую структуру директорий для модулей (например, `src/auth`, `src/users`, `src/core`).
    * [x] Настроить ESLint и Prettier с рекомендуемыми конфигурациями для NestJS/TypeScript.
* **Технологические Указания:**
    * NestJS (последняя стабильная версия).
    * TypeScript.
    * PostgreSQL (версия 14+).
    * Prisma ORM (последняя стабильная версия).
    * Менеджер пакетов: yarn.
* **Нефункциональные Требования:**
    * Читаемость кода: сгенерированная структура проекта должна быть логичной.
* **Формат Вывода:**
    * Предоставить команды для инициализации проекта и установки зависимостей.
    * Предоставить структуру основных конфигурационных файлов (`package.json`, `tsconfig.json`, `.env.example`, `prisma/schema.prisma`).
* **Вопросы для Уточнения:** Задавайте вопросы, если требуются специфические настройки проекта.
* **Документирование Кода:** Основные конфигурационные файлы должны быть понятны.
* **Генерация Тестов:** На данном этапе не требуется.
* **Измененные файлы:**
    * backend/prisma/schema.prisma
    * и другие файлы, созданные автоматически при инициализации проекта.

---

#### Подзадача 1.1.3: Настройка Docker-окружения
* **Контекст и Цель:**
    * **Цель:** Обеспечить консистентную среду для локальной разработки Frontend и Backend с использованием Docker.
    * **Контекст:** Часть задачи 1.1. Зависит от инициализации Frontend (1.1.1) и Backend (1.1.2) проектов.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [x] Создать `Dockerfile` для Frontend (Next.js) приложения.
    * [x] Создать `Dockerfile` для Backend (NestJS) приложения.
    * [x] Создать `docker-compose.yml` файл, описывающий:
        * [x] Сервис для Frontend (на основе `frontend/Dockerfile`).
        * [x] Сервис для Backend (на основе `backend/Dockerfile`).
        * [x] Сервис для базы данных PostgreSQL (используя официальный образ).
    * [x] Настроить переменные окружения для всех сервисов в `docker-compose.yml` (ссылаясь на `.env` файлы, где это возможно).
    * [x] Настроить volumes для сохранения данных PostgreSQL.
    * [x] Настроить volumes для hot-reloading кода Frontend и Backend при разработке.
    * [x] Обеспечить корректную сетевую связь между Frontend, Backend и БД внутри Docker.
    * [x] Проверить, что все сервисы успешно собираются и запускаются командой `docker-compose up -d --build`.
* **Технологические Указания:**
    * Docker, Docker Compose.
* **Формат Вывода:**
    * Предоставить `docker-compose.yml` файл.
    * Предоставить `frontend/Dockerfile`.
    * Предоставить `backend/Dockerfile`.
    * Краткие инструкции по запуску (`docker-compose up`).
* **Вопросы для Уточнения:** Уточните, если есть специфические требования к портам или именованию сервисов.
* **Измененные файлы:**
    * docker-compose.yml
    * frontend/Dockerfile
    * backend/Dockerfile

---

#### Подзадача 1.1.4: Настройка базового CI/CD пайплайна
* **Контекст и Цель:**
    * **Цель:** Автоматизировать базовые проверки качества кода и сборку проектов при коммитах.
    * **Контекст:** Часть задачи 1.1. Зависит от инициализации проектов (1.1.1, 1.1.2).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [x] Выбрать CI/CD систему (по умолчанию GitHub Actions, если не указано иное).
    * [x] Создать конфигурационный файл для CI/CD (например, `.github/workflows/main.yml`).
    * [x] Настроить триггеры запуска пайплайна (например, при push в ветки `develop` и `main`).
    * [x] Реализовать этапы пайплайна для Frontend:
        * [x] Установка зависимостей (`yarn install`).
        * [x] Линтинг кода (`yarn lint`).
        * [x] Сборка проекта (`yarn build`).
        * [x] Запуск заглушек unit-тестов (если есть, `yarn test`).
    * [x] Реализовать этапы пайплайна для Backend:
        * [x] Установка зависимостей (`yarn install`).
        * [x] Линтинг кода (`yarn lint`).
        * [x] Сборка проекта (`yarn build`).
        * [x] Запуск заглушек unit-тестов (если есть, `yarn test`).
    * [x] Убедиться, что пайплайн успешно проходит на тестовых коммитах.
* **Технологические Указания:**
    * GitHub Actions или GitLab CI.
* **Формат Вывода:**
    * Предоставить конфигурационный файл CI/CD.
* **Вопросы для Уточнения:** Уточните предпочтительную CI/CD систему, если есть.
* **Измененные файлы:**
    * .github/workflows/main.yml

---

### Задача 1.2: Ядро: Модуль Аутентификации и Пользователей (Backend + Frontend)

* **Контекст и Цель:**
    * **Цель:** Реализовать модуль аутентификации и управления пользователями в Backend-части MVP.
    * **Контекст:** Базовый функционал, необходимый для регистрации и входа пользователей, а также управления их профилями. Основа для других модулей, требующих аутентификацию и авторизацию.
* **Ожидаемый Результат (Acceptance Criteria):**
    * [x] Реализованная модель данных пользователей в БД.
    * [x] Реализованные эндпоинты для регистрации и аутентификации.
    * [x] Реализованные механизмы управления сессиями (JWT, refresh tokens).
    * [x] Разграничение прав доступа на основе ролей (RBAC).
    * [x] Базовые механизмы восстановления пароля.
* **Итеративность:** Разработку модуля можно разделить на подзадачи.

---

#### Подзадача 1.2.1: Проектирование и Реализация Схемы БД для User и Company
* **Контекст и Цель:**
    * **Цель:** Спроектировать и реализовать схему базы данных для хранения данных пользователей и компаний клиентов.
    * **Контекст:** Часть задачи 1.2. Является фундаментом для реализации аутентификации и управления пользователями.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [x] Спроектировать модель `User` с полями: `id`, `email`, `password` (хешированный), `firstName`, `lastName`, `phone` (опционально), `role` (enum: 'ADMIN', 'CLIENT', 'EMPLOYEE', 'CONCIERGE'), `isActive`, `isEmailVerified`, токены для сброса пароля, и т.д.
    * [x] Спроектировать модель `Company` с полями: `id`, `name`, `inn` (ИНН, опционально), `description` (опционально), `address` (опционально), и т.д.
    * [x] Определить отношения между `User` и `Company`: пользователь-предприниматель (CLIENT) и сотрудники (EMPLOYEE) связаны с компанией (многие к одной).
    * [x] Реализовать схему в Prisma (`schema.prisma`).
    * [x] Реализовать и выполнить начальную миграцию Prisma.
* **Технологические Указания:**
    * Prisma ORM для моделирования схемы и миграций.
    * PostgreSQL в качестве СУБД.
* **Формат Вывода:**
    * Файл схемы Prisma `schema.prisma`.
    * Файлы миграций в директории Prisma.
* **Документирование Кода:** 
    * Исчерпывающие комментарии к моделям и связям.
* **Генерация Тестов:**
    * Не требуется на данном этапе.
* **Измененные файлы:**
    * backend/prisma/schema.prisma
    * backend/prisma/migrations/YYYYMMDDHHMMSS_init_user_company/migration.sql (автоматически создан Prisma)

---

#### Подзадача 1.2.2: Реализация Аутентификации
* **Контекст и Цель:**
    * **Цель:** Реализовать механизмы регистрации, аутентификации и авторизации пользователей.
    * **Контекст:** Часть задачи 1.2. Зависит от подзадачи 1.2.1 (схема БД).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [x] Реализовать AuthModule в NestJS.
    * [x] Реализовать endpoints для регистрации нового пользователя (Предпринимателя, создаётся с ролью CLIENT):
        * [x] Валидация входных данных (email, пароль, имя, фамилия, название компании).
        * [x] Хеширование пароля перед сохранением в БД.
        * [x] Создание компании вместе с пользователем (транзакция).
        * [x] Возврат JWT токена после успешной регистрации.
    * [x] Реализовать endpoints для входа (login):
        * [x] Валидация учетных данных (email, пароль).
        * [x] Сравнение хешированного пароля.
        * [x] Выдача JWT токена.
        * [x] Имплементировать механизм refresh-токенов для продления сессии.
    * [x] Реализовать механизм восстановления пароля:
        * [x] Endpoint для запроса сброса пароля (по email).
        * [x] Генерация и сохранение уникального одноразового токена для сброса.
        * [x] Endpoint для установки нового пароля по токену.
    * [x] Реализовать JWT стратегию в NestJS (Passport).
    * [x] Реализовать guard для защиты endpoints, требующих аутентификации.
    * [x] Реализовать механизм авторизации на основе ролей (RBAC) для разграничения доступа.
* **Технологические Указания:**
    * NestJS, Passport.js для аутентификации.
    * JWT для токенов сессии.
    * bcrypt для хеширования паролей.
* **Формат Вывода:**
    * Controller, Service и Module файлы для AuthModule.
    * DTO и Entity файлы для объектов аутентификации.
    * Strategy файлы для Passport.js.
* **Документирование Кода:**
    * Комментарии к методам аутентификации и авторизации.
    * Описание flow аутентификации в комментариях.
* **Генерация Тестов:**
    * Модульные тесты для валидации учетных данных, хеширования и сравнения паролей.
* **Измененные файлы:**
    * backend/src/auth/auth.module.ts
    * backend/src/auth/auth.service.ts
    * backend/src/auth/auth.controller.ts
    * backend/src/auth/dto/
    * backend/src/auth/strategies/
    * backend/src/auth/guards/
    * backend/src/users/users.service.ts

---

#### Подзадача 1.2.3: Управление Пользователями
* **Контекст и Цель:**
    * **Цель:** Реализовать API для управления пользователями.
    * **Контекст:** Часть задачи 1.2. Зависит от подзадач 1.2.1 и 1.2.2.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [x] Реализовать UsersModule в NestJS.
    * [x] Реализовать endpoint для получения профиля текущего пользователя.
    * [x] Реализовать endpoint для обновления данных профиля пользователя.
    * [x] Реализовать endpoints для администратора:
        * [x] Получение списка всех пользователей (с пагинацией и фильтрацией).
        * [x] Получение детальной информации о конкретном пользователе.
        * [x] Изменение роли пользователя.
        * [x] Активация/деактивация пользователя.
        * [x] Удаление пользователя (мягкое удаление, если применимо).
    * [x] Реализовать endpoints для работы предпринимателя с сотрудниками своей компании:
        * [x] Создание приглашения для нового сотрудника.
        * [x] Получение списка сотрудников компании.
        * [x] Управление доступом сотрудника (активация/деактивация).
        * [x] Удаление сотрудника из компании.
* **Технологические Указания:**
    * NestJS, `@nestjs/jwt`, `passport`, `passport-jwt`, DTO.
* **Фокус на Безопасности:** Короткое время жизни access token, безопасное хранение (httpOnly, 
secure, samesite cookie) и передача refresh token, защита от CSRF для эндпоинта logout (если 
применимо, для MVP можно опустить).
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для методов логина и обновления токена в `AuthService`.
* **Формат Вывода:** Код контроллера, сервиса, DTO, JWT strategy, конфигурации модуля JWT.
* **Измененные файлы:** *(ожидается от ИИ: `src/auth/auth.controller.ts`, `src/auth/auth.service.
ts`, `src/auth/dto/login-user.dto.ts`, `src/auth/strategies/jwt.strategy.ts`, `src/auth/auth.
module.ts`)*

---

#### Подзадача 1.2.4: Backend: API для восстановления пароля
* **Контекст и Цель:**
    * **Цель:** Реализовать функционал сброса и установки нового пароля.
    * **Контекст:** Часть модуля Аутентификации. Ссылаться на ТЗ 4.1.2, 7.3.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Forgot Password:**
        * [x] Создать DTO (`ForgotPasswordDto`) для валидации Email.
        * [x] Реализовать в `AuthService` метод для запроса восстановления пароля:
            * [x] Поиск пользователя по Email.
            * [x] Генерация уникального токена сброса пароля.
            * [x] Сохранение хэша токена и времени его жизни в БД для пользователя (например, 
            поля `resetPasswordToken` и `resetPasswordExpires` в модели `User`).
            * [x] Инициирование отправки email пользователю (логика отправки будет в Модуле 
            Уведомлений, здесь – подготовка данных для письма).
        * [x] Реализовать в `AuthController` эндпоинт `POST /auth/forgot-password`.
    * **Reset Password:**
        * [x] Создать DTO (`ResetPasswordDto`) для валидации токена сброса и нового пароля.
        * [x] Реализовать в `AuthService` метод для сброса пароля:
            * [x] Поиск пользователя по токену сброса (с учетом времени жизни токена).
            * [x] Хэширование нового пароля.
            * [x] Обновление пароля пользователя в БД.
            * [x] Инвалидация (удаление или пометка как использованный) токена сброса.
        * [x] Реализовать в `AuthController` эндпоинт `POST /auth/reset-password`.
* **Технологические Указания:**
    * NestJS, Prisma, DTO.
* **Фокус на Безопасности:** Безопасность токенов сброса (одноразовые, короткое время жизни, 
хэширование), защита от перебора, валидация нового пароля.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для методов запроса восстановления и сброса пароля в 
`AuthService`.
* **Формат Вывода:** Код контроллера, сервиса, DTO.
* **Измененные файлы:** backend/src/auth/dto/forgot-password.dto.ts, backend/src/auth/dto/reset-password.dto.ts, backend/src/auth/auth.service.ts, backend/src/auth/auth.controller.ts, backend/src/users/users.service.ts, backend/src/auth/auth.service.spec.ts, Docs/changelog.md

---

#### Подзадача 1.2.5: Backend: API для управления профилем пользователя
* **Контекст и Цель:**
    * **Цель:** Предоставить пользователю возможность просматривать и обновлять данные своего 
    профиля.
    * **Контекст:** Часть модуля Пользователей. Ссылаться на ТЗ 4.1.3, 7.3. Защищено JWT Guard.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Get Profile:**
        * [x] Реализовать в `UsersController` (или `ProfileController`) эндпоинт `GET /users/me`.
        * [x] Сервис (`UsersService`) должен возвращать данные текущего аутентифицированного 
        пользователя (из JWT).
    * **Update Profile:**
        * [x] Создать DTO (`UpdateProfileDto`) для валидации обновляемых данных (Имя, Фамилия, 
        Контактный телефон - все опциональны).
        * [x] Реализовать в `UsersService` метод для обновления профиля.
        * [x] Реализовать в `UsersController` эндпоинт `PUT /users/me`.
    * **Change Password:**
        * [x] Создать DTO (`ChangePasswordDto`) для валидации текущего и нового паролей.
        * [x] Реализовать в `UsersService` метод для смены пароля:
            * [x] Проверка текущего пароля.
            * [x] Хэширование нового пароля.
            * [x] Обновление пароля в БД.
        * [x] Реализовать в `UsersController` эндпоинт `PUT /users/me/password`.
* **Технологические Указания:**
    * NestJS, Prisma, DTO, `@UseGuards(JwtAuthGuard)`.
* **Фокус на Безопасности:** Проверка принадлежности данных текущему пользователю, безопасная 
смена пароля (проверка старого пароля).
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для методов сервиса управления профилем.
* **Формат Вывода:** Код контроллера, сервиса, DTO.
* **Измененные файлы:** backend/src/users/dto/update-profile.dto.ts, backend/src/users/dto/change-password.dto.ts, backend/src/users/users.service.ts, backend/src/users/users.controller.ts, backend/src/users/users.service.spec.ts, Docs/changelog.md

---

#### Подзадача 1.2.6: Frontend: Страницы и формы Регистрации, Входа, Восстановления пароля
* **Контекст и Цель:**
    * **Цель:** Создать пользовательский интерфейс для процессов аутентификации.
    * **Контекст:** Часть модуля Аутентификации. Зависит от соответствующих Backend API (1.2.2, 1.
    2.3, 1.2.4).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [x] Создать страницу `/register` с формой регистрации (поля из ТЗ 4.1.1).
    * [x] Создать страницу `/login` с формой входа (поля из ТЗ 4.1.2).
    * [x] Создать страницу `/forgot-password` с формой запроса восстановления пароля.
    * [x] Создать страницу `/reset-password/[token]` с формой установки нового пароля.
    * [x] Для всех форм использовать компоненты `shadcn/ui`.
    * [x] Реализовать валидацию на стороне клиента с использованием `react-hook-form` и `zod`.
    * [x] Интегрировать формы с соответствующими Backend API эндпоинтами.
    * [x] Реализовать корректную обработку успешных ответов (например, редирект на дашборд после 
    логина/регистрации).
    * [x] Реализовать отображение ошибок валидации и серверных ошибок пользователю (например, 
    через `Toast` из `shadcn/ui`).
* **Технологические Указания:**
    * Next.js (App Router), React, TypeScript, `shadcn/ui`, `react-hook-form`, `zod`.
* **Формат Вывода:** Код React компонентов для страниц и форм.
* **Измененные файлы:** 
    * frontend/src/app/(auth)/register/page.tsx
    * frontend/src/app/(auth)/login/page.tsx
    * frontend/src/app/(auth)/forgot-password/page.tsx
    * frontend/src/app/(auth)/reset-password/[token]/page.tsx
    * frontend/src/app/(auth)/layout.tsx
    * frontend/src/components/ui/toast.tsx
    * frontend/src/components/ui/toaster.tsx
    * frontend/src/components/ui/use-toast.ts
    * frontend/src/components/ui/button.tsx
    * frontend/src/components/ui/input.tsx

---

#### Подзадача 1.2.7: Frontend: Базовая страница Профиля пользователя
* **Контекст и Цель:**
    * **Цель:** Создать интерфейс для просмотра и редактирования профиля пользователя.
    * **Контекст:** Часть модуля Пользователей. Зависит от Backend API `/users/me` (1.2.5). 
    Страница должна быть защищена (требуется аутентификация).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [x] Создать страницу профиля пользователя (например, `/dashboard/profile` или `/account/
    settings`).
    * [x] Реализовать отображение текущих данных пользователя (Имя, Фамилия, Email, Телефон), 
    полученных с бэкенда.
    * [x] Реализовать форму для редактирования Имени, Фамилии, Телефона с использованием 
    компонентов `shadcn/ui`.
    * [x] Реализовать форму для смены пароля (текущий пароль, новый пароль, подтверждение нового) 
    с использованием `shadcn/ui`.
    * [x] Интегрировать формы с соответствующими Backend API (`PUT /users/me`, `PUT /users/me/
    password`).
    * [x] Обеспечить обратную связь пользователю (сообщения об успехе/ошибке).
* **Технологические Указания:**
    * Next.js, React, TypeScript, `shadcn/ui`, `react-hook-form`, `zod`.
* **Формат Вывода:** Код React компонентов.
* **Измененные файлы:**
    * frontend/src/app/dashboard/profile/page.tsx
    * frontend/src/app/dashboard/layout.tsx
    * frontend/src/app/dashboard/page.tsx
    * frontend/src/app/dashboard/requests/page.tsx

---

#### Подзадача 1.2.8: Frontend: Интеграция с API аутентификации и профиля
* **Контекст и Цель:**
    * **Цель:** Обеспечить взаимодействие Frontend с Backend для аутентификации и управления 
    профилем, включая управление состоянием аутентификации пользователя.
    * **Контекст:** Сквозная задача для Frontend, затрагивающая все части приложения, требующие 
    информации о пользователе или защиты роутов.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [x] Создать сервисные функции или хуки в `lib/` или `hooks/` для инкапсуляции логики 
    HTTP-запросов к API эндпоинтам аутентификации и профиля.
    * [x] Реализовать глобальное управление состоянием аутентификации пользователя (например, 
    через React Context API + Hooks или Zustand). Состояние должно включать информацию о 
    пользователе и флаг аутентификации.
    * [x] Реализовать механизм защиты роутов (Route Guards / Middleware в Next.js) для страниц, 
    требующих аутентификации. Неаутентифицированные пользователи должны перенаправляться на 
    страницу входа.
    * [x] При успешном входе/регистрации JWT токены (access token) должны безопасно сохраняться 
    (например, в памяти, а refresh token обрабатывается через httpOnly cookie бэкендом) и 
    использоваться для последующих запросов.
    * [x] Реализовать функцию выхода из системы (вызов API `/auth/logout`, очистка состояния 
    аутентификации на клиенте, редирект).
    * [x] Обеспечить автоматическое обновление access token с использованием refresh token при 
    его истечении (если это не обрабатывается полностью на уровне HTTP-клиента).
* **Технологические Указания:**
    * Fetch API или `axios` для HTTP-запросов. React Context API или Zustand для управления 
    состоянием. Next.js Middleware или компоненты высшего порядка для защиты роутов.
* **Формат Вывода:** Код сервисов/хуков, провайдера состояния, middleware/HOC для защиты роутов.
* **Измененные файлы:**
    * frontend/src/context/AuthContext.tsx
    * frontend/src/middleware.ts
    * frontend/src/lib/auth/types.ts
    * frontend/src/lib/auth/api.ts
    * frontend/src/app/api/auth/login/route.ts
    * frontend/src/app/api/auth/register/route.ts
    * frontend/src/app/api/auth/logout/route.ts
    * frontend/src/app/api/auth/refresh-token/route.ts
    * frontend/src/app/api/auth/forgot-password/route.ts
    * frontend/src/app/api/auth/reset-password/route.ts
    * frontend/src/app/api/users/me/route.ts
    * frontend/src/app/api/users/me/password/route.ts
* **Документирование Кода:**
    * Комментарии к методам управления пользователями.
* **Генерация Тестов:**
    * Модульные тесты для методов сервиса пользователей.
* **Измененные файлы:**
    * backend/src/users/users.module.ts
    * backend/src/users/users.service.ts
    * backend/src/users/users.controller.ts
    * backend/src/users/dto/

---

### Задача 1.3: Ядро: Модуль Компаний и Сотрудников (Backend + Frontend - базовый)

* **Контекст и Цель:**
    * **Цель:** Реализовать базовый функционал управления информацией о компании и приглашения сотрудников.
    * **Контекст:** Часть Ядра Платформы. Зависит от модуля Аутентификации и Пользователей (1.2). Схема БД для Company уже должна быть создана в 1.2.1.
* **Ожидаемый Результат (Acceptance Criteria):**
    * [x] Предприниматель может просматривать и редактировать основные данные своей компании.
    * [x] Предприниматель может приглашать новых сотрудников в свою компанию по email.
    * [x] Приглашенные сотрудники могут завершить регистрацию (этот флоу частично покрывается регистрацией, но нужно убедиться, что они привязываются к компании).
    * [x] Предприниматель видит список сотрудников своей компании.
    * [x] Бэкенд-логика покрыта unit-тестами (не менее 70%).
* **Итеративность:** Разработку API и UI можно вести параллельно.

---

#### Подзадача 1.3.1: Backend: API для управления данными компании
* **Контекст и Цель:**
    * **Цель:** Предоставить Предпринимателю возможность управлять информацией о своей компании.
    * **Контекст:** Часть модуля Компаний. Ссылаться на ТЗ 4.1.3, 7.3. Защищено JWT Guard, доступ только для роли "Предприниматель".
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [x] Реализовать в `CompaniesController` эндпоинт `GET /companies/my`.
        * [x] Сервис (`CompaniesService`) должен возвращать данные компании, к которой принадлежит текущий аутентифицированный Предприниматель.
    * [x] Создать DTO (`UpdateCompanyDto`) для валидации обновляемых данных компании (Название, ИНН, Описание, Адрес - все опциональны).
    * [x] Реализовать в `CompaniesService` метод для обновления данных компании.
    * [x] Реализовать в `CompaniesController` эндпоинт `PUT /companies/my`.
    * [x] Реализовать Guard (`CompanyOwnerGuard` или аналогичный) для проверки, что операцию выполняет владелец компании.
* **Технологические Указания:**
    * NestJS, Prisma, DTO, Guards.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для методов сервиса компаний.
* **Формат Вывода:** Код контроллера, сервиса, DTO, Guard.
* **Измененные файлы:** `src/companies/companies.controller.ts`, `src/companies/companies.service.ts`, `src/companies/dto/update-company.dto.ts`, `src/companies/guards/company-owner.guard.ts`

---

#### Подзадача 1.3.2: Backend: API для приглашения и управления сотрудниками (базовое)
* **Контекст и Цель:**
    * **Цель:** Позволить Предпринимателям приглашать сотрудников и управлять их списком.
    * **Контекст:** Часть модуля Компаний. Ссылаться на ТЗ 4.1.4, 7.3. Защищено JWT Guard, доступ только для роли "Предприниматель".
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Приглашение сотрудника:**
        * [x] Создать DTO (`InviteEmployeeDto`) для валидации Email приглашаемого сотрудника.
        * [x] Реализовать в `CompaniesService` метод для приглашения сотрудника:
            * [x] Проверка, не является ли email уже существующим пользователем в другой компании или администратором.
            * [x] Создание новой записи `User` с ролью "Сотрудник Компании Клиента", привязкой к `companyId` текущего Предпринимателя, и временным статусом (например, `isActive=false`, `isEmailVerified=false`).
            * [x] Генерация уникального токена приглашения.
            * [x] Инициирование отправки email-приглашения сотруднику со ссылкой для завершения регистрации (установки пароля и активации аккаунта, ссылка должна содержать токен приглашения).
        * [x] Реализовать в `CompaniesController` эндпоинт `POST /companies/my/employees`.
    * **Список сотрудников:**
        * [x] Реализовать в `CompaniesService` метод для получения списка сотрудников компании текущего Предпринимателя.
        * [x] Реализовать в `CompaniesController` эндпоинт `GET /companies/my/employees`.
    * **Удаление/деактивация сотрудника:**
        * [x] Реализовать в `CompaniesService` метод для удаления/деактивации сотрудника (по `employeeId`).
        * [x] Реализовать в `CompaniesController` эндпоинт `DELETE /companies/my/employees/{employeeId}`.
* **Технологические Указания:**
    * NestJS, Prisma, DTO.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для методов сервиса управления сотрудниками.
* **Формат Вывода:** Код контроллера, сервиса, DTO.
* **Измененные файлы:** *(ожидается от ИИ: `src/companies/companies.controller.ts`, `src/companies/companies.service.ts`, `src/companies/dto/invite-employee.dto.ts`, обновление `prisma/schema.prisma` для `User` (токен приглашения, если нужен отдельный), обновление `AuthService` для обработки завершения регистрации по приглашению)*

---

#### Подзадача 1.3.3: Frontend: Интерфейс для управления компанией и сотрудниками
* **Контекст и Цель:**
    * **Цель:** Предоставить Предпринимателю удобный интерфейс для управления данными компании и сотрудниками.
    * **Контекст:** Часть модуля Компаний. Ссылаться на ТЗ 4.1.3, 4.1.4, 7.3. Доступ только для роли "Предприниматель".
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [x] Создать типы и API-клиент для работы с компаниями и сотрудниками:
        * [x] Типы для данных компании (`Company`) и сотрудника (`Employee`).
        * [x] Типы для DTO обновления компании (`UpdateCompanyDto`) и приглашения сотрудника (`InviteEmployeeDto`).
        * [x] Функции для взаимодействия с API компаний и сотрудников.
    * [x] Реализовать компоненты управления компанией:
        * [x] Компонент формы редактирования данных компании (`CompanyForm`).
        * [x] Компонент списка сотрудников с возможностью удаления (`EmployeesList`).
        * [x] Компонент формы приглашения новых сотрудников (`InviteEmployeeForm`).
    * [x] Интегрировать компоненты на странице настроек компании:
        * [x] Обновить страницу `/dashboard/company` для отображения формы компании и списка сотрудников.
        * [x] Добавить модальное окно для приглашения сотрудников.
        * [x] Реализовать обработку ошибок и уведомления пользователя.
* **Технологические Указания:**
    * Next.js, React, TypeScript, shadcn/ui, react-hook-form, zod.
* **Документирование Кода:** JSDoc/TSDoc.
* **Формат Вывода:** Код React компонентов и страниц.
* **Измененные файлы:** `src/lib/companies/types.ts`, `src/lib/companies/api.ts`, `src/components/company/CompanyForm.tsx`, `src/components/company/EmployeesList.tsx`, `src/components/company/InviteEmployeeForm.tsx`, `src/app/dashboard/company/page.tsx`

---

### Задача 1.4: UI: Базовый Каркас Приложения

* **Контекст и Цель:**
    * **Цель:** Создать основную визуальную структуру и навигацию приложения.
    * **Контекст:** Основа для всего пользовательского интерфейса. Зависит от инициализации Frontend-проекта (1.1.1).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Основной лейаут:**
        * [x] Создать компонент `RootLayout` (`app/layout.tsx`) с базовой структурой HTML (head, body).
        * [x] Интегрировать провайдеры (например, для темы `shadcn/ui`, AuthContext).
    * **Шапка (Header):**
        * [x] Создать компонент `Header` (`components/layout/Header.tsx`).
        * [x] Отображение логотипа.
        * [x] Условное отображение:
            * Для неаутентифицированных: ссылки "Войти", "Регистрация".
            * Для аутентифицированных: имя пользователя, выпадающее меню с ссылками "Профиль", "Настройки компании" (если применимо), "Выход".
    * **Подвал (Footer):**
        * [x] Создать компонент `Footer` (`components/layout/Footer.tsx`).
        * [x] Отображение базовой информации (например, копирайт, год).
    * **Лейаут Личного Кабинета (Dashboard Layout):**
        * [x] Создать компонент лейаута для защищенных страниц (например, `app/dashboard/layout.tsx`).
        * [x] Включить `Header` и `Footer`.
        * [x] Реализовать боковую навигационную панель (Sidebar) (`components/layout/Sidebar.tsx`) со ссылками на основные разделы ЛК (Дашборд, Запросы, Подрядчики, Шаблоны, Тарифы, Настройки Компании, Профиль).
        * [x] Обеспечить корректное отображение основного контента рядом с Sidebar.
    * **Страницы-заглушки и Роутинг:**
        * [x] Создать базовые страницы-заглушки (простые компоненты с заголовком) для всех основных разделов MVP, указанных в Sidebar.
        * [x] Настроить роутинг в Next.js (App Router) для всех этих страниц.
    * **Адаптивность:**
        * [x] Обеспечить базовую адаптивность Header, Footer, Sidebar для мобильных устройств (например, Sidebar может становиться скрытым меню-бургером).
* **Технологические Указания:**
    * Next.js (App Router), React, TypeScript, `shadcn/ui`, Tailwind CSS.
* **Формат Вывода:** Код React компонентов для лейаутов, навигации, страниц-заглушек.
* **Вопросы для Уточнения:** Уточните, если есть конкретные пожелания по дизайну логотипа (можно использовать плейсхолдер) или структуре навигации.
* **Измененные файлы:**
    * frontend/src/app/layout.tsx
    * frontend/src/app/dashboard/layout.tsx
    * frontend/src/app/dashboard/requests/page.tsx
    * frontend/src/app/dashboard/page.tsx

---
**Демонстрация и Утверждение в конце Спринта 1:**
* **Запрос на одобрение:** "Спринт 1 завершен. Реализованы: работающая регистрация, вход, выход; возможность редактирования профиля пользователя и компании; базовый UI-каркас с навигацией и страницами-заглушками; CI/CD пайплайн выполняет базовые проверки. Прошу утвердить для перехода к Спринту 2."
* **Статус проверки:** Произведена итоговая проверка выполнения всех задач Спринта 1. Все задачи и подзадачи успешно выполнены, включая корректную интеграцию компонентов Header и Footer в интерфейс приложения. Выполнена проверка и исправление ошибок линтера в проекте. Проект полностью готов к переходу к Спринту 2.
* **Задачи для разработчика (пользователя):** На данном этапе не предвидится, если ИИ справится с настройкой окружения и CI/CD.

---
---

## Спринт 2: Модуль Управления Запросами и Консьерж-Сервис (Недели 3-4)

**Цель Спринта:** Реализовать ключевой функционал платформы – создание и управление запросами, включая чат между клиентом и консьерж-менеджером.

### Задача 2.0: Технический долг и рефакторинг
* **Контекст и Цель:**
    * **Цель:** Исправить ошибки линтера и улучшить качество кода.
    * **Контекст:** Необходимо исправить ошибки, выявленные в конце Спринта 1, для повышения качества и поддерживаемости кода.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Исправление ошибок линтера в бэкенде:**
        * [ ] Исправить ошибки типизации (unsafe assignments, unsafe calls, unsafe returns).
        * [ ] Исправить неиспользуемые переменные и импорты.
        * [ ] Исправить ошибки в async/await функциях.
        * [ ] Исправить неправильные регулярные выражения.
    * **Исправление ошибок линтера во фронтенде:**
        * [ ] Исправить неиспользуемые переменные и импорты.
        * [ ] Исправить ошибки типизации.
        * [ ] Исправить ошибки в хуках React.
    * **Улучшение типизации:**
        * [ ] Добавить более строгую типизацию для API запросов и ответов.
        * [ ] Улучшить типизацию для компонентов React.

### Задача 2.1: Ядро: Модуль Управления Запросами (Backend)
* **Контекст и Цель:**
    * **Цель:** Позволить пользователям (Предпринимателям/Сотрудникам) создавать запросы на услуги, а Консьерж-менеджерам – управлять ими.
    * **Контекст:** Основной инструмент взаимодействия клиента с платформой. Зависит от Ядра Платформы (Спринт 1).
* **Ожидаемый Результат (Acceptance Criteria):**
    * [ ] Пользователи могут создавать запросы с детальным описанием и прикреплением файлов.
    * [ ] Пользователи видят список своих запросов и их статусы.
    * [ ] Консьерж-менеджеры видят и обрабатывают запросы.
    * [ ] Реализована загрузка файлов к запросам (хранение локально для MVP с планом миграции в облако).
    * [ ] Бэкенд-логика покрыта unit-тестами (не менее 70%).
* **Итеративность:** Разработку API и UI можно вести параллельно.
* **Фокус на Безопасности:** Валидация входящих данных, проверка прав доступа к запросам, безопасная обработка загружаемых файлов (проверка типа, размера; антивирусная проверка для MVP исключена или максимально упрощена).

---

#### Подзадача 2.1.1: Проектирование и реализация схемы БД для Request, RequestFile
* **Контекст и Цель:**
    * **Цель:** Создать таблицы в БД для хранения информации о запросах и связанных с ними файлах.
    * **Контекст:** Основа для Модуля Запросов. Ссылаться на ТЗ Раздел 6.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Определить модель `Request` в `prisma/schema.prisma` со всеми полями из ТЗ (Раздел 6).
    * [ ] Определить модель `RequestFile` в `prisma/schema.prisma` со всеми полями из ТЗ (Раздел 6).
    * [ ] Установить связи между `Request` и `User` (клиент, консьерж), `Request` и `Company`, `Request` и `RequestFile`.
    * [ ] Сгенерировать миграцию Prisma (`yarn prisma migrate dev --name add_requests_tables`).
    * [ ] Применить миграцию к базе данных.
* **Технологические Указания:** PostgreSQL, Prisma ORM.
* **Формат Вывода:** Обновленный `prisma/schema.prisma`, файлы миграций.
* **Измененные файлы:** `prisma/schema.prisma`, файлы в `prisma/migrations/`.

---

#### Подзадача 2.1.2: Backend: API для создания Запроса
* **Контекст и Цель:**
    * **Цель:** Реализовать эндпоинт для создания новых запросов пользователями.
    * **Контекст:** Часть Модуля Запросов. Ссылаться на ТЗ 4.2.1, 7.3.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Создать DTO (`CreateRequestDto`) для валидации данных нового запроса (Тема, Категория, Описание, Ожидаемый результат, опционально Срочность, Срок, Бюджет).
    * [ ] Реализовать в `RequestsService` метод для создания запроса:
        * [ ] Валидация данных.
        * [ ] Создание записи `Request` в БД, связывая с `clientId` и `companyId` аутентифицированного пользователя.
        * [ ] Присвоение статуса "Новый".
    * [ ] Настроить загрузку файлов с использованием `multer` (или аналогичного модуля NestJS) и `FileInterceptor`.
        * [ ] Файлы сохраняются локально в выделенную директорию (например, `uploads/request_files/`).
        * [ ] В БД (`RequestFile`) сохраняются метаданные о файлах (имя, путь/URL, размер, тип).
        * [ ] **Примечание MVP:** Антивирусная проверка файлов при загрузке для MVP исключается или реализуется в максимально упрощенном виде (проверка по типу файла и размеру).
    * [ ] Реализовать в `RequestsController` эндпоинт `POST /requests`, принимающий данные формы и файлы.
* **Технологические Указания:** NestJS, Prisma, `multer`, DTO.
* **Фокус на Безопасности:** Валидация типов и размеров файлов, проверка прав пользователя на создание запроса.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для сервиса создания запросов (включая логику обработки файлов).
* **Формат Вывода:** Код контроллера, сервиса, DTO, конфигурация `multer`.
* **Измененные файлы:** `src/requests/requests.controller.ts`, `src/requests/requests.service.ts`, `src/requests/dto/create-request.dto.ts`, `src/files/files.service.ts` (если логика работы с файлами вынесена).

---

#### Подзадача 2.1.3: Backend: API для просмотра и управления Запросами
* **Контекст и Цель:**
    * **Цель:** Реализовать эндпоинты для получения списка запросов, их деталей и обновления статусов.
    * **Контекст:** Часть Модуля Запросов. Ссылаться на ТЗ 4.2.2, 4.2.3, 7.3.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Список запросов (`GET /requests`):**
        * [ ] Реализовать в `RequestsService` метод для получения списка запросов с пагинацией, фильтрацией (по статусу, категории, `clientId`, `companyId`, `conciergeId`) и сортировкой.
        * [ ] В `RequestsController` эндпоинт должен учитывать роль пользователя (Клиент видит запросы своей компании, Консьерж – назначенные ему или все новые).
    * **Детали запроса (`GET /requests/{id}`):**
        * [ ] Реализовать в `RequestsService` метод для получения деталей одного запроса по ID, включая связанные файлы и историю чата (если чат уже реализован).
        * [ ] В `RequestsController` эндпоинт должен проверять права доступа к запросу.
    * **Обновление запроса (`PUT /requests/{id}`):**
        * [ ] Создать DTO (`UpdateRequestDto`) для обновления статуса запроса и назначения `conciergeId` (для Консьерж-менеджера).
        * [ ] Реализовать в `RequestsService` метод для обновления запроса.
        * [ ] В `RequestsController` эндпоинт должен быть доступен только Консьерж-менеджерам.
* **Технологические Указания:** NestJS, Prisma, DTO. Использовать Guards для проверки ролей и прав доступа.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для методов сервиса.
* **Формат Вывода:** Код контроллеров, сервисов, DTO, Guards.
* **Измененные файлы:** `src/requests/requests.controller.ts`, `src/requests/requests.service.ts`, `src/requests/dto/update-request.dto.ts`, `src/requests/guards/request-access.guard.ts`.

---

#### Подзадача 2.1.4: Frontend: Форма создания и страницы просмотра Запросов
* **Контекст и Цель:**
    * **Цель:** Создать UI для создания и просмотра запросов.
    * **Контекст:** Часть Модуля Запросов. Зависит от Backend API (2.1.2, 2.1.3).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Создание Запроса:**
        * [ ] Создать страницу или модальное окно (например, `/dashboard/requests/new`) с формой для создания нового Запроса.
        * [ ] Форма должна содержать все поля из ТЗ 4.2.1 (Тема, Категория, Описание и т.д.).
        * [ ] Реализовать загрузку файлов (до 5 шт., до 50МБ) с использованием `shadcn/ui` компонентов для выбора файлов.
        * [ ] Использовать `react-hook-form` и `zod` для валидации формы.
        * [ ] Интегрировать с API `POST /requests`.
    * **Список Запросов:**
        * [ ] Создать страницу `/dashboard/requests` для отображения списка запросов Предпринимателя/Сотрудника.
        * [ ] Реализовать пагинацию, фильтры (по статусу, категории) и сортировку с использованием `shadcn/ui` компонентов (Table, Select, Input).
        * [ ] Каждая строка должна быть кликабельной и вести на страницу деталей запроса.
        * [ ] Интегрировать с API `GET /requests`.
    * **Детали Запроса:**
        * [ ] Создать страницу `/dashboard/requests/[id]` для отображения деталей запроса.
        * [ ] Отображать всю информацию о запросе: Тема, Категория, Описание, Статус, Прикрепленные файлы (со ссылками для скачивания).
        * [ ] Интегрировать с API `GET /requests/{id}`.
* **Технологические Указания:** Next.js, React, TypeScript, `shadcn/ui`, `react-hook-form`, `zod`.
* **Формат Вывода:** Код React компонентов.
* **Измененные файлы:** `app/dashboard/requests/new/page.tsx`, `app/dashboard/requests/page.tsx`, `app/dashboard/requests/[id]/page.tsx`, компоненты в `components/requests/`.

---

### Задача 2.2: Интерфейс Консьерж-Менеджера (Backend + Frontend - базовый)
* **Контекст и Цель:**
    * **Цель:** Предоставить Консьерж-менеджерам базовые инструменты для работы с запросами клиентов.
    * **Контекст:** Часть Модуля Управления Запросами. Зависит от API Запросов (2.1.3). Доступ только для роли "Консьерж-менеджер".
* **Ожидаемый Результат (Acceptance Criteria):**
    * [ ] Консьерж-менеджер может видеть список новых и находящихся в работе запросов.
    * [ ] Консьерж-менеджер может принять запрос в работу и изменять его статус.
    * [ ] Реализована базовая логика назначения запросов на бэкенде (для MVP - взятие в работу из общего списка).
* **Итеративность:** UI можно разрабатывать итерационно.

---

#### Подзадача 2.2.1: Frontend: Базовый интерфейс Консьерж-Менеджера
* **Контекст и Цель:**
    * **Цель:** Создать UI для Консьерж-менеджеров для управления запросами.
    * **Контекст:** Часть задачи 2.2.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Создать защищенные роуты/страницы для Консьерж-менеджера (например, `/concierge/dashboard`, `/concierge/requests`).
    * [ ] На странице `/concierge/requests` (или аналогичной):
        * [ ] Отображение списка новых запросов (не назначенных).
        * [ ] Отображение списка запросов, находящихся в работе у текущего Консьерж-менеджера (или всех, если так решено).
        * [ ] Использовать таблицу `shadcn/ui` с фильтрами и сортировкой.
    * [ ] На странице деталей запроса (можно переиспользовать `/dashboard/requests/[id]`, но с дополнительными элементами управления для консьержа):
        * [ ] Возможность для Консьерж-менеджера взять запрос в работу (если он "Новый" и не назначен).
        * [ ] Возможность изменить статус запроса (выбор из доступных статусов).
    * [ ] Интеграция с Backend API (`GET /requests` с параметрами для консьержа, `PUT /requests/{id}`).
* **Технологические Указания:** Next.js, React, TypeScript, `shadcn/ui`.
* **Формат Вывода:** Код React компонентов.
* **Измененные файлы:** Файлы в `app/concierge/` (или аналогичной структуре), `components/concierge/`, модификация `app/dashboard/requests/[id]/page.tsx` для условного рендеринга.

---

### Задача 2.3: Чат Клиент-Консьерж (Backend + Frontend)
* **Контекст и Цель:**
    * **Цель:** Обеспечить возможность коммуникации между клиентом и Консьерж-менеджером в рамках каждого запроса.
    * **Контекст:** Важная часть Модуля Управления Запросами. Зависит от Модуля Запросов (2.1).
* **Ожидаемый Результат (Acceptance Criteria):**
    * [ ] Пользователи (Клиент и назначенный Консьерж) могут обмениваться текстовыми сообщениями по конкретному запросу.
    * [ ] Реализована возможность прикрепления файлов в чат (согласно ТЗ 4.2.4 - "полноценно").
    * [ ] Отображается история сообщений.
    * [ ] Бэкенд-логика покрыта unit-тестами.
* **Итеративность:** Можно сначала реализовать текстовый чат, затем добавить файлы.
* **Фокус на Безопасности:** Проверка прав на доступ к чату конкретного запроса. Безопасная обработка файлов.

---

#### Подзадача 2.3.1: Проектирование и реализация схемы БД для ChatMessage
* **Контекст и Цель:**
    * **Цель:** Создать таблицу в БД для хранения сообщений чата.
    * **Контекст:** Основа для функционала чата. Ссылаться на ТЗ Раздел 6.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] Определить модель `ChatMessage` в `prisma/schema.prisma` со всеми полями из ТЗ (Раздел 6).
    * [ ] Установить связи с `Request` (к какому запросу относится сообщение) и `User` (кто отправитель).
    * [ ] Сгенерировать миграцию Prisma (`yarn prisma migrate dev --name add_chat_messages_table`).
    * [ ] Применить миграцию к базе данных.
* **Технологические Указания:** PostgreSQL, Prisma ORM.
* **Формат Вывода:** Обновленный `prisma/schema.prisma`, файлы миграций.
* **Измененные файлы:** `prisma/schema.prisma`, файлы в `prisma/migrations/`.

---

#### Подзадача 2.3.2: Backend: API для Чата
* **Контекст и Цель:**
    * **Цель:** Реализовать эндпоинты для отправки и получения сообщений чата.
    * **Контекст:** Часть задачи 2.3. Ссылаться на ТЗ 4.2.4, 7.3.
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * **Отправка сообщения:**
        * [ ] Создать DTO (`CreateChatMessageDto`) для валидации текста сообщения и опционального файла.
        * [ ] Реализовать в `ChatService` (или `RequestsService`) метод для сохранения нового сообщения, включая обработку загрузки файла для чата (аналогично файлам запроса).
        * [ ] Реализовать в `ChatController` (или `RequestsController`) эндпоинт `POST /requests/{id}/messages`.
    * **Получение сообщений:**
        * [ ] Реализовать в `ChatService` метод для получения истории сообщений по `requestId` с пагинацией.
        * [ ] Реализовать в `ChatController` эндпоинт `GET /requests/{id}/messages`.
    * [ ] Валидация входящих данных.
    * [ ] Проверка прав доступа пользователя к чату данного запроса (пользователь должен быть клиентом по этому запросу или назначенным консьержем).
* **Технологические Указания:** NestJS, Prisma, DTO, `multer` для файлов.
* **Документирование Кода:** JSDoc/TSDoc.
* **Генерация Тестов:** Unit-тесты для сервиса чата.
* **Формат Вывода:** Код контроллера, сервиса, DTO.
* **Измененные файлы:** `src/chat/chat.controller.ts`, `src/chat/chat.service.ts`, `src/chat/dto/create-chat-message.dto.ts` (или аналоги в модуле `requests`).

---

#### Подзадача 2.3.3: Frontend: UI Чата
* **Контекст и Цель:**
    * **Цель:** Создать интерфейс чата на странице детального просмотра запроса.
    * **Контекст:** Часть задачи 2.3. Зависит от Backend API Чата (2.3.2).
* **Ожидаемый Результат (Acceptance Criteria) / Детализированные подзадачи:**
    * [ ] На странице детального просмотра Запроса (`/dashboard/requests/[id]`) интегрировать компонент чата.
    * [ ] Реализовать отображение списка сообщений:
        * [ ] Сообщения текущего пользователя выровнены по одной стороне, сообщения собеседника – по другой.
        * [ ] Отображение имени/роли отправителя и времени отправки.
        * [ ] Отображение текста сообщения.
        * [ ] Отображение прикрепленных файлов со ссылками для скачивания/просмотра.
    * [ ] Реализовать форму для ввода текстового сообщения и кнопку отправки.
    * [ ] Реализовать возможность прикрепления файла к сообщению.
    * [ ] Интегрировать с API `POST /requests/{id}/messages` для отправки и `GET /requests/{id}/messages` для получения истории.
    * [ ] Реализовать обновление списка сообщений (для MVP - по кнопке "обновить" или при отправке нового сообщения; real-time не требуется для MVP).
* **Технологические Указания:** Next.js, React, TypeScript, `shadcn/ui`.
* **Формат Вывода:** Код React компонентов для чата.
* **Измененные файлы:** Компоненты в `components/chat/` или `components/requests/chat/`, обновление `app/dashboard/requests/[id]/page.tsx`.

---
**Демонстрация и Утверждение в конце Спринта 2:**
* **Запрос на одобрение:** "Спринт 2 завершен. Реализованы: полный цикл создания и обработки запроса (без подбора подрядчика), работающий чат по запросам с возможностью прикрепления файлов, базовый интерфейс Консьерж-менеджера. Прошу утвердить для перехода к Спринту 3."
* **Задачи для разработчика (пользователя):** Возможно, потребуется настройка облачного хранилища для файлов, если принято решение использовать его сразу. Если нет, ИИ реализует локальное хранение.

---
---

## Спринт 3: Монетизация и Знания (Недели 5-6)

**Цель Спринта:** Реализовать систему тарифов и оплаты, а также предоставить доступ к Базе Подрядчиков и Шаблонам.

*(Задачи для Спринта 3 будут детализированы аналогичным образом)*

---
---

## Спринт 4: Завершение MVP и Подготовка к Запуску (Недели 7-8)

**Цель Спринта:** Реализовать оставшийся функционал MVP (Дашборд, Уведомления, Админ-панель), провести комплексное тестирование и подготовить платформу к запуску.

*(Задачи для Спринта 4 будут детализированы аналогичным образом)*

---

## Задачи для Разработчика (Пользователя) в ходе проекта:

* [ ] **Перед Спринтом 3 (или в его начале):** Предоставить ИИ данные для первоначального наполнения Базы Подрядчиков (15-20 записей) и Библиотеки Шаблонов (5-10 файлов) в согласованном формате (JSON/CSV) для создания seed-скриптов.
* [ ] **Перед Спринтом 3 (или в его начале):** Определить и предоставить ИИ конкретные параметры для 2-3 тарифов MVP (названия, цены, ключевые отличия по функциям).
* [ ] **Перед Спринтом 3 (или в его начале):** Принять решение и, при необходимости, предоставить доступы/инструкции для интеграции с выбранным платежным шлюзом (Tinkoff Kassa).
* [ ] **Перед Спринтом 4 (или в его начале):** Принять решение и, при необходимости, предоставить доступы/инструкции для интеграции с выбранным Email-сервисом (SendGrid или аналог).
* [ ] **В ходе Спринта 4:** Провести комплексное ручное тестирование всех пользовательских сценариев MVP.
* [ ] **В ходе Спринта 4:** Подготовить (совместно с ИИ) минимальную пользовательскую документацию/FAQ.
* [ ] **В ходе Спринта 4:** Выполнить финальную настройку Production-среды, доменного имени, SSL-сертификатов, если это не будет полностью автоматизировано ИИ.
* [ ] **Регулярно:** Предоставлять обратную связь и утверждения по предложенным ИИ UI-макетам и по завершению спринтов.