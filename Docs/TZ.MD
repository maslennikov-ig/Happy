# Техническое Задание (ТЗ) на разработку Платформы для Предпринимателей (MVP)

**Версия документа:** 1.2
**Дата:** 10 мая 2025 г.

## 1. Введение

### 1.1. Назначение документа
Настоящее Техническое Задание (ТЗ) определяет требования к разработке Минимально Жизнеспособного Продукта (MVP) Платформы для Предпринимателей. Документ предназначен для команды разработки, включая ИИ-ассистентов, и служит основным руководством для проектирования, разработки, тестирования и внедрения MVP.

### 1.2. Миссия и Цели Платформы
* **Миссия Проекта (долгосрочная):** Сделать 1 миллион человек счастливее к 2030 году.
* **Цель Платформы (долгосрочная):** Предоставить предпринимателям комплексный инструмент ("единое окно") для эффективного управления бизнесом, снижения стресса, экономии времени и ресурсов, а также создания условий для личного благополучия и благополучия команды.
* **Бизнес-цель (долгосрочная):** Выйти на чистый доход 10 млн рублей в месяц.
* **Цель MVP (2 месяца):** Запустить базовую версию платформы, предоставляющую предпринимателям возможность решать операционные задачи через консьерж-сервис с доступом к проверенным подрядчикам и шаблонам, тем самым экономя их время и снижая стресс. Проверить основные гипотезы и собрать обратную связь для дальнейшего развития.

### 1.3. Целевая аудитория MVP
* **Предприниматели (владельцы малого и среднего бизнеса) в РФ.**
* **Их команды** (в рамках MVP с ограниченным функционалом для сотрудников).

### 1.4. Определения и Аббревиатуры
* **Платформа:** Разрабатываемый онлайн-сервис.
* **MVP:** Минимально Жизнеспособный Продукт.
* **Пользователь:** Любое лицо, взаимодействующее с Платформой.
* **Предприниматель:** Основной клиент Платформы, владелец бизнеса.
* **Сотрудник Компании Клиента:** Пользователь, приглашенный Предпринимателем.
* **Консьерж-менеджер:** Сотрудник Платформы, обрабатывающий запросы клиентов.
* **Подрядчик:** Проверенный внешний специалист/компания из базы Платформы.
* **ЛК:** Личный кабинет.
* **API:** Программный интерфейс приложения (Application Programming Interface).
* **UI:** Пользовательский интерфейс (User Interface).
* **UX:** Пользовательский опыт (User Experience).
* **CRUD:** Create, Read, Update, Delete – базовые операции с данными.
* **TZ:** Техническое Задание.
* **ФЗ-152:** Федеральный закон "О персональных данных".

## 2. Общие Требования к Платформе (MVP)

### 2.1. Обзор Платформы (MVP)
MVP Платформы представляет собой веб-приложение, доступное через браузер. Основные функции MVP включают:
* Регистрацию и аутентификацию Предпринимателей.
* Управление профилем компании и сотрудниками (базовое).
* Систему тарификации (2-3 тарифа) с оплатой подписок и разовых услуг.
* Создание и отслеживание запросов Предпринимателями через консьерж-сервис.
* Обработку запросов Консьерж-менеджерами.
* Внутренний чат для общения между Предпринимателем и Консьерж-менеджером.
* Доступ к ограниченной базе проверенных Подрядчиков (контакт через Консьерж-менеджера).
* Доступ к библиотеке базовых шаблонов документов.
* Информационный дашборд для Предпринимателя.
* Систему уведомлений (внутрисистемные и email).

### 2.2. Технологический стек
* **Frontend:**
    * Язык: TypeScript
    * Фреймворк: React
    * Мета-фреймворк: Next.js
    * Стилизация: Tailwind CSS. **Использовать готовые UI-компоненты из библиотеки `shadcn/ui` для обеспечения консистентности, современного и стильного вида, а также для ускорения разработки фронтенда.**
* **Backend:**
    * Язык: TypeScript
    * Платформа: Node.js
    * Фреймворк: NestJS
* **База данных:** PostgreSQL
* **Кэширование:** Redis (для будущих итераций, для MVP – опционально, если не критично для производительности основных функций).
* **Взаимодействие Frontend-Backend:** REST API, JSON.
* **Аутентификация:** JWT (JSON Web Tokens).

### 2.3. Требования к производительности (MVP)
* Время ответа сервера на типовые запросы API: не более 500 мс (95-й перцентиль).
* Время загрузки основных страниц для пользователей с типичным интернет-соединением (First Contentful Paint - FCP): не более 2 секунд.
* Платформа должна выдерживать нагрузку до 100 одновременно активных пользователей без существенной деградации производительности (для MVP).

### 2.4. Требования к безопасности
* Соблюдение ФЗ-152 в части сбора, хранения и обработки персональных данных пользователей из РФ.
* Защита от основных веб-уязвимостей (OWASP Top 10), включая XSS, SQL-инъекции, CSRF.
* Использование HTTPS для всего трафика.
* Хранение паролей в хэшированном виде с использованием современных алгоритмов (например, bcrypt, Argon2).
* Безопасность платежных данных: интеграция с платежным шлюзом должна соответствовать стандартам PCI DSS (сама платформа не хранит полные данные карт).
* Разграничение прав доступа на основе ролей.
* Регулярное резервное копирование данных (ежедневное).
* Антивирусная проверка загружаемых файлов.

### 2.5. Требования к масштабируемости
* Архитектура должна быть спроектирована с учетом будущего роста количества пользователей (до 5000 предпринимателей в первый год) и данных.
* Для MVP реализовать вертикальное масштабирование. Горизонтальное масштабирование заложить архитектурно для бэкенда.
* Использование облачных сервисов для хостинга и базы данных, которые поддерживают масштабирование.

### 2.6. Требования к надежности и доступности (MVP)
* Доступность платформы: 99.5% в месяц (допустимое время простоя ~3.5 часа в месяц).
* Обеспечить отказоустойчивость базовых компонентов.

### 2.7. Требования к пользовательскому интерфейсу (UI/UX)
* Интерфейс должен быть интуитивно понятным, современным, стильным и адаптивным. Использование `shadcn/ui` и Tailwind CSS должно способствовать этому.
* Дизайн должен быть чистым, профессиональным и вызывать доверие.
* Обеспечить консистентность элементов управления и навигации по всей платформе.
* Адаптивный дизайн для корректного отображения на десктопных и мобильных устройствах (смартфоны, планшеты).
* Основные пользовательские сценарии должны выполняться за минимальное количество шагов.
* Предусмотреть четкую обратную связь на действия пользователя (индикаторы загрузки, сообщения об успехе/ошибке).
* **Для MVP приоритетом является функциональность и интуитивная понятность интерфейса, а не сложный визуальный дизайн. Ожидается чистый, минималистичный, но профессиональный и современный вид.**
* **Для ключевых экранов MVP (например, Регистрация, Вход, Создание Запроса, Список Запросов, Дашборд) ИИ должен сначала предложить базовую структуру и расположение элементов с использованием компонентов `shadcn/ui`, которые затем могут быть утверждены или скорректированы.**
* **Для Административной Панели в MVP ожидается минималистичный, но функциональный UI, позволяющий выполнять CRUD-операции, перечисленные в разделе 7.3 (управление пользователями (Консьержи), подрядчиками, шаблонами, тарифами). Сложный дизайн или расширенная аналитика для админ-панели не требуются в MVP.**

### 2.8. Требования к браузерам и устройствам
* Поддержка последних двух версий основных браузеров: Google Chrome, Mozilla Firefox, Safari, Edge.
* Корректное отображение на экранах с разрешением от 360px в ширину (мобильные) до 1920px и выше (десктоп).

### 2.9. Язык Платформы
* Основной язык интерфейса и всего контента для MVP: **Русский**.

### 2.10. Функционал, не входящий в MVP
Следующие функции и модули **не входят** в объем работ для MVP и откладываются на последующие итерации:
* Полноценный Модуль Календаря и Управления Мероприятиями (кроме возможного отображения информации о доступных консультациях на Дашборде, если это будет частью MVP-тарифа и не потребует сложной логики календаря).
* Полноценный Модуль Аналитики, Аудита и Оценки Состояния Команды. Функционал MVP по оценке состояния команды ограничен предоставлением шаблонов вопросов для внешних инструментов и возможностью загрузки агрегированных результатов для простого отображения и шаблонных рекомендаций (согласно документу `Список хотелок для платформы` и последующим уточнениям).
* Полноценная автоматизированная Рекомендательная Система (в MVP возможны только самые простые, вручную настроенные подсказки общего характера).
* Форум или Сообщество для Предпринимателей.
* Глубокие интеграции с внешними системами бизнеса (кроме необходимой интеграции с выбранным платежным шлюзом).
* ИИ-Бот-Юрист.
* Полноценный Конструктор документов (в MVP только скачивание статических шаблонов).
* Двусторонняя синхронизация с внешними календарями (в MVP только экспорт .ics).
* Автоматический скоринг внешних кандидатов в Подрядчики.
* Продвинутые инструменты для Выделенных Ассистентов и Стратегов/Аналитиков (их роли и инструменты для MVP минимальны или отсутствуют, если не указано иное в описании тарифов MVP).
* Мобильные приложения (в MVP только адаптивный веб-интерфейс).

## 3. Пользовательские Роли и Права Доступа (MVP)

| Роль                        | Описание                                                                 | Ключевые права доступа в MVP                                                                                                                                                                                                                                                           |
| --------------------------- | ------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Предприниматель/Владелец бизнеса** | Основной клиент, регистрирующий компанию на платформе.                | Регистрация, аутентификация, управление своим профилем и профилем компании, управление тарифами и оплатами, создание и просмотр своих запросов, общение в чате с Консьерж-менеджером, просмотр Базы Подрядчиков (ограниченно), скачивание шаблонов, просмотр дашборда, управление Сотрудниками. |
| **Сотрудник Компании Клиента** | Приглашенный Предпринимателем сотрудник его компании.                   | Аутентификация, просмотр своего профиля, создание и просмотр запросов компании (всех или назначенных ему, TBD), общение в чатах по этим запросам, просмотр Базы Подрядчиков (согласно правам компании), скачивание шаблонов. **Не имеет доступа к биллингу и управлению подпиской.** |
| **Консьерж-менеджер** | Сотрудник платформы, обрабатывающий запросы клиентов.                     | Аутентификация, просмотр и управление назначенными/всеми запросами клиентов, общение с клиентами в чате, взаимодействие с Базой Подрядчиков (поиск, выбор для клиента), просмотр профилей клиентов.                                                                                  |
| **Администратор Платформы** | Управляет системой (суперпользователь).                                   | Аутентификация, управление пользователями всех ролей (создание Консьерж-менеджеров, блокировка), управление тарифами, управление Базой Подрядчиков (добавление, редактирование), управление Библиотекой Шаблонов, просмотр системной статистики (базовой).                                    |
| **Проверенный Подрядчик/Эксперт** | Внешний специалист. (В MVP эта роль не имеет личного кабинета). | Данные о подрядчиках хранятся в системе и управляются Администратором. Консьерж-менеджер использует эти данные для подбора.                                                                                                                                                            |

## 4. Функциональные Требования (MVP)

### 4.1. Модуль Пользовательского Управления и Доступа (MVP)

#### 4.1.1. Регистрация Предпринимателя
* **Описание:** Пользователь может зарегистрироваться на платформе как Предприниматель.
* **Поля формы регистрации:** Email (логин), Пароль, Повтор пароля, Имя, Фамилия, Название компании, ИНН компании (опционально для MVP, но предусмотреть).
* **Процесс:**
    1.  Пользователь заполняет форму.
    2.  Система проверяет уникальность Email.
    3.  Система проверяет валидность данных (сложность пароля, корректность Email).
    4.  Создается учетная запись Предпринимателя и связанная с ним Компания.
    5.  (Опционально для MVP, но желательно) Отправляется Email для подтверждения регистрации. Пользователь должен перейти по ссылке в письме для активации аккаунта.
* **UI:** Отдельная страница регистрации.

#### 4.1.2. Аутентификация Пользователей
* **Описание:** Зарегистрированные пользователи могут войти в систему.
* **Поля формы входа:** Email, Пароль.
* **Процесс:**
    1.  Пользователь вводит Email и Пароль.
    2.  Система проверяет учетные данные.
    3.  При успехе пользователь перенаправляется в ЛК (Дашборд).
    4.  Реализовать механизм "Запомнить меня" (через refresh token).
    5.  Реализовать функцию "Восстановление пароля" через Email.
* **UI:** Отдельная страница входа.

#### 4.1.3. Управление Профилем Предпринимателя
* **Описание:** Предприниматель может просматривать и редактировать данные своего профиля и компании.
* **Редактируемые поля профиля пользователя:** Имя, Фамилия, Контактный телефон.
* **Редактируемые поля компании:** Название компании, ИНН, Описание деятельности (краткое), Адрес (опционально).
* **Возможность смены пароля.**
* **UI:** Раздел "Профиль" или "Настройки" в ЛК.

#### 4.1.4. Управление Сотрудниками Компании Клиента (Базовое)
* **Описание:** Предприниматель может приглашать сотрудников своей компании на платформу и управлять их доступом.
* **Функционал:**
    1.  Приглашение нового сотрудника по Email. Сотруднику отправляется ссылка для завершения регистрации и установки пароля.
    2.  Список сотрудников компании с указанием их Email и статуса (активен/приглашен).
    3.  Возможность деактивировать/удалить сотрудника из компании.
    4.  В MVP все приглашенные сотрудники получают единую роль "Сотрудник Компании Клиента" с предопределенными правами (см. Раздел 3).
* **UI:** Раздел "Команда" или "Сотрудники" в ЛК Предпринимателя.

#### 4.1.5. Система Тарифов (2-3 тарифа)
* **Описание:** Платформа предоставляет несколько тарифных планов с разным набором функций и лимитов.
* **Количество тарифов для MVP:** 2 или 3 (например, "Базовый", "Стандарт", "Профи").
* **Параметры тарифов (управляются Администратором):** Название, Цена (ежемесячная/годовая), Описание, Набор доступных функций/лимитов (например, количество запросов в месяц, доступ к определенным категориям подрядчиков/шаблонов).
* **Функционал для Предпринимателя:**
    1.  Просмотр доступных тарифных планов и их сравнение.
    2.  Выбор и оплата тарифа (подписка).
    3.  Просмотр текущего тарифа и даты следующего списания.
    4.  Возможность сменить тариф (апгрейд/даунгрейд с соответствующим пересчетом).
* **UI:** Страница "Тарифы", раздел "Управление подпиской" в ЛК.

### 4.2. Модуль Управления Запросами и Консьерж-Сервис (MVP)

#### 4.2.1. Создание Запроса Предпринимателем (или Сотрудником)
* **Описание:** Пользователь (Предприниматель или Сотрудник) может создать новый запрос на услугу или консультацию.
* **Поля формы создания запроса:**
    * Тема запроса (краткое название).
    * Категория запроса (выбор из списка, например: Юридические, Финансы, Маркетинг, HR, IT, Административные, Прочее. Список категорий управляется Администратором).
    * Подробное описание задачи/проблемы.
    * Ожидаемый результат.
    * Опционально: Срочность (выбор из: Низкая, Средняя, Высокая).
    * Опционально: Желаемый срок выполнения (дата).
    * Опционально: Бюджет (если применимо, текстовое поле или диапазон).
    * Опционально: Прикрепление файлов (до 5 файлов, общим размером до 50 МБ, типы: PDF, DOCX, XLSX, JPG, PNG. Реализовать антивирусную проверку при загрузке).
* **Процесс:**
    1.  Пользователь заполняет форму.
    2.  Система сохраняет запрос со статусом "Новый".
    3.  Запрос становится доступен Консьерж-менеджерам.
    4.  Пользователь получает уведомление о создании запроса.
* **UI:** Отдельная форма/модальное окно для создания запроса.

#### 4.2.2. Личный Кабинет: Список Запросов и Статусы
* **Описание:** Предприниматель и его Сотрудники могут просматривать список своих/компании запросов и их текущие статусы.
* **Отображаемая информация по каждому запросу:** ID, Тема, Категория, Дата создания, Статус, Исполнитель (Консьерж-менеджер).
* **Статусы запросов (минимальный набор для MVP):**
    * Новый
    * В работе (принят Консьерж-менеджером)
    * Требует уточнения (от Консьерж-менеджера клиенту)
    * Ожидает ответа клиента
    * Передан подрядчику (если применимо)
    * Выполнен
    * Отменен
* **Функционал:**
    1.  Фильтрация запросов по статусу, категории.
    2.  Сортировка запросов по дате создания, статусу.
    3.  Переход к детальному просмотру запроса (включая чат).
* **UI:** Раздел "Мои запросы" / "Запросы компании" в ЛК.

#### 4.2.3. Интерфейс Консьерж-менеджера: Управление Запросами
* **Описание:** Консьерж-менеджер имеет интерфейс для просмотра и обработки запросов клиентов.
* **Функционал:**
    1.  Список всех "Новых" запросов (неразобранных).
    2.  Возможность взять запрос в работу (статус меняется на "В работе", назначается текущий Консьерж-менеджер).
    3.  Просмотр деталей запроса (все поля, прикрепленные файлы).
    4.  Изменение статуса запроса.
    5.  Добавление внутренних комментариев к запросу (невидимых клиенту).
    6.  Поиск и фильтрация запросов (по клиенту, статусу, дате, категории).
    7.  Доступ к Базе Проверенных Подрядчиков для подбора исполнителя.
    8.  Возможность зафиксировать информацию о подобранном подрядчике (внутренне).
* **UI:** Отдельный раздел для Консьерж-менеджеров.

#### 4.2.4. Система Общения (Чат Клиент-Консьерж)
* **Описание:** Реализовать простой текстовый чат для каждого запроса.
* **Участники чата:** Клиент (Предприниматель/Сотрудник, создавший запрос или имеющий к нему доступ) и Консьерж-менеджер, работающий над запросом.
* **Функционал:**
    1.  Отправка текстовых сообщений.
    2.  Отображение истории сообщений.
    3.  Уведомление о новых сообщениях (внутрисистемное и email).
    4.  (Опционально для MVP) Возможность прикрепления файлов в чат.
* **UI:** Интегрирован в страницу детального просмотра запроса.

### 4.3. Модуль Управления Знаниями и Инструментами (MVP)

#### 4.3.1. База Проверенных Подрядчиков (Просмотр, контакт через консьержа)
* **Описание:** Предоставить Предпринимателям доступ к информации о проверенных Подрядчиках.
* **Наполнение для MVP:** 15-20 Подрядчиков, данные вносятся Администратором.
* **Отображаемая информация по Подрядчику (для Клиента):** Название/ФИО, Лого/Фото (если есть), Краткое описание, Специализации/Категории услуг, Описание услуг, Кейсы (текстовое описание, без файлов для MVP), Отзывы (текстовые, добавленные Администратором для MVP), Рейтинг (если реализуется в MVP, то простой, например, средняя оценка от Администратора).
* **Функционал для Предпринимателя:**
    1.  Просмотр списка Подрядчиков.
    2.  Фильтры: по Специализации/Категории, Нише/Отрасли (если применимо), Рейтингу (если есть), Ключевым словам (поиск по описанию).
    3.  Просмотр детального профиля Подрядчика.
    4.  **Контакт с Подрядчиком:** В MVP – **только через Консьерж-менеджера**. На странице Подрядчика кнопка "Запросить контакт" или "Обсудить с консьержем", которая инициирует создание нового запроса или уведомляет Консьерж-менеджера. Прямые контакты Подрядчиков скрыты.
* **Доступ в зависимости от тарифа (для MVP можно упростить):**
    * **Уровень 1 (Базовый):** Ограниченный просмотр (например, только список и краткое описание, без кейсов/отзывов).
    * **Уровень 2 (Средний/Профи):** Полный доступ к профилям (в рамках MVP-контента).
* **UI:** Раздел "Подрядчики" или "Эксперты" в ЛК.

#### 4.3.2. Библиотека Шаблонов и Подсказок (Статические файлы)
* **Описание:** Предоставить Предпринимателям доступ к коллекции полезных шаблонов документов и инструкций.
* **Наполнение для MVP:** 5-10 ключевых шаблонов (например, шаблон договора, NDA, должностной инструкции). Файлы в форматах PDF, DOCX. Загружаются Администратором.
* **Функционал для Предпринимателя:**
    1.  Просмотр списка доступных шаблонов с названием и кратким описанием.
    2.  Категоризация шаблонов (если необходимо).
    3.  Поиск шаблонов по названию, ключевым словам.
    4.  Скачивание выбранного шаблона.
* **Версионирование для MVP:** Просто указание даты последнего обновления файла Администратором.
* **Конструктор документов и ИИ-Бот-Юрист: НЕ ВХОДЯТ в MVP.**
* **UI:** Раздел "Шаблоны" или "База знаний" в ЛК.

### 4.4. Общие Системные Функции (MVP)

#### 4.4.1. Дашборд Предпринимателя
* **Описание:** Сводная информационная панель для Предпринимателя при входе в ЛК.
* **Содержимое для MVP (не настраиваемое пользователем):**
    1.  Количество активных запросов (со ссылкой на список).
    2.  Последние 3-5 уведомлений.
    3.  Быстрый доступ к созданию нового запроса.
    4.  (Если применимо по тарифу) Информация о доступных квартальных консультациях (в MVP этот функционал может быть упрощен до информационного блока).
* **UI:** Главная страница ЛК Предпринимателя.

#### 4.4.2. Система Уведомлений (Внутрисистемные, Email)
* **Описание:** Информирование пользователей о важных событиях на платформе.
* **Каналы для MVP:**
    1.  **Внутрисистемные уведомления:** Отображаются в специальном разделе/виджете в интерфейсе Платформы (например, иконка "колокольчик" с счетчиком новых).
    2.  **Email-уведомления:** Отправляются на зарегистрированный Email пользователя.
* **Ключевые события для уведомлений (MVP):**
    * Успешная регистрация (Email).
    * Создание нового запроса (внутрисистемное для клиента).
    * Новое сообщение в чате по запросу (внутрисистемное, Email).
    * Изменение статуса запроса (внутрисистемное, Email для клиента).
    * Назначение Консьерж-менеджера на запрос (внутрисистемное для клиента).
    * Уведомление о предстоящей оплате подписки (Email).
    * Успешная/неуспешная оплата (Email).
    * Приглашение нового сотрудника (Email для сотрудника).
* **Настройка уведомлений пользователем для MVP:** Минимальная или отсутствует (все важные уведомления отправляются).

#### 4.4.3. Платежный Модуль (Интеграция, управление подписками, разовые платежи)
* **Описание:** Обеспечение приема платежей за подписки на тарифы и возможные разовые услуги.
* **Платежный шлюз для MVP (РФ):** Интеграция с одним из: ЮKassa, Tinkoff Kassa, CloudPayments. Выбор шлюза должен быть сделан до начала разработки этой части. ИИ должен быть проинструктирован о конкретном API.
* **Валюта для MVP:** Только российский рубль (RUB).
* **Функционал:**
    1.  **Управление подписками:**
        * Оформление ежемесячной/годовой (если предусмотрено) подписки на тариф.
        * Автоматические рекуррентные платежи.
        * Уведомления о предстоящем списании.
        * Обработка неуспешных платежей (повторные попытки, уведомления, затем возможная блокировка платных функций или перевод на бесплатный/ограниченный тариф).
        * Возможность отмены подписки.
    2.  **Разовые платежи:** Возможность оплаты дополнительных услуг, если такие будут определены для MVP (например, "дополнительная консультация" сверх лимита тарифа – пока не детализировано, но предусмотреть возможность).
    3.  **История платежей:** Предприниматель может видеть историю своих оплат в ЛК.
    4.  **Счета/Акты для юрлиц (РФ):** Если предполагается оплата от юрлиц по счету (для MVP это может быть ручным процессом), то для оплат картой физлиц – автоматическая генерация PDF квитанций/чеков (через платежный шлюз). Для MVP акцент на онлайн-оплату картами.
* **Безопасность:** Платформа не должна хранить полные данные банковских карт. Взаимодействие с платежным шлюзом через защищенные протоколы, использование токенизации.
* **UI:** Раздел "Оплата", "Подписка", "История платежей" в ЛК.

## 5. Нефункциональные Требования для ИИ-разработчика

### 5.1. Качество кода
* **Язык:** Весь код должен быть написан на TypeScript (frontend и backend).
* **Чистота и Читаемость:** Код должен быть чистым, хорошо структурированным, следовать принципам SOLID (где применимо) и DRY. Имена переменных, функций, классов должны быть осмысленными (на английском языке).
* **Комментирование:**
    * Комментарии должны объяснять *почему* что-то сделано определенным образом, а не *что* делается (это должно быть очевидно из кода).
    * Публичные API (функции, классы, методы) должны иметь JSDoc/TSDoc комментарии, описывающие их назначение, параметры и возвращаемые значения.
    * Сложные или неочевидные участки кода должны быть прокомментированы.
* **Форматирование:** Использовать автоматические форматеры кода (например, Prettier) и линтеры (например, ESLint) с согласованными конфигурациями для всего проекта. Конфигурационные файлы для них должны быть частью репозитория.
* **Обработка ошибок:** Реализовать корректную обработку ошибок и исключений. Не допускать "тихих" ошибок. Использовать try-catch, глобальные обработчики ошибок.

### 5.2. Тестирование
* **Unit-тесты:** Для критически важной бизнес-логики (сервисы в NestJS, сложные React-компоненты/хуки) должны быть написаны unit-тесты. Использовать Jest или аналогичный фреймворк. Ожидаемое покрытие для новой логики – не менее 70%.
* **Интеграционные тесты (базовые):** Для проверки взаимодействия между ключевыми компонентами (например, контроллер-сервис-база данных).
* **E2E тесты (End-to-End):** Для MVP не являются обязательными, но ИИ должен генерировать код, который легко поддается E2E тестированию в будущем (например, добавляя `data-testid` атрибуты к интерактивным элементам).

### 5.3. Следование конвенциям стека
* **Next.js:** Использовать принятые практики Next.js (маршрутизация, получение данных `getServerSideProps`/`getStaticProps`, API routes и т.д.).
* **NestJS:** Следовать архитектурным паттернам NestJS (модули, контроллеры, сервисы, DTO, pipes, guards).
* **React:** Использовать функциональные компоненты и хуки.

### 5.4. Логирование
* Реализовать базовое логирование событий на бэкенде: запросы к API, ошибки, важные системные события. Использовать стандартный логгер NestJS или Winston/Pino.
* Логи должны быть структурированными (например, JSON) для упрощения анализа.
* Не логировать чувствительную информацию (пароли, токены, персональные данные).

### 5.5. Конфигурация
* Все конфигурационные параметры (строки подключения к БД, ключи API, секреты JWT, настройки портов и т.д.) должны выноситься в переменные окружения (`.env` файлы). Не допускать хардкодинга конфигурации. Предоставить `.env.example` файл.

### 5.6. Первоначальное Наполнение Данными (Сидинг)
* Для первоначального наполнения Базы Подрядчиков (15-20 записей) и Библиотеки Шаблонов (5-10 файлов) ИИ должен предусмотреть возможность запуска seed-скриптов, которые будут заполнять базу данных тестовыми/начальными данными при первом запуске или по команде.
* Формат данных для сидинга (например, JSON или CSV-файлы) будет предоставлен отдельно, или ИИ может предложить структуру на основе Модели Данных (Раздел 6).
* Seed-скрипты должны быть идемпотентными (безопасны для повторного запуска).

### 5.7. Дополнительные Принципы Разработки для ИИ
* **Выбор библиотек и версий:**
    * Всегда сначала производить поиск готовой, активно поддерживаемой библиотеки или компонента, а не разрабатывать аналогичный функционал с нуля.
    * Предпочтение отдается использованию самых новых, но стабильных (LTS или рекомендованных для production) версий библиотек, компонентов и модулей.
    * При возникновении проблем с зависимостями, если обновление до последних стабильных версий невозможно или создает неразрешимые конфликты, следует отказаться от проблемного модуля и найти современную, совместимую альтернативу, а не фиксировать старые или уязвимые зависимости.
* **Архитектура и Качество:**
    * Всегда предлагать архитектурные улучшения или альтернативные варианты реализации, если это может повысить модульность, читаемость, тестируемость или масштабируемость системы.
    * Использовать современные лучшие практики (best practices) для выбранных технологий (например, Server Components и App Router в Next.js, структурирование кода по функциональным модулям (feature-based/domain-based), эффективное использование паттернов NestJS и возможностей Prisma ORM).
    * При необходимости обращаться к официальной документации используемых технологий и фреймворков для поиска актуальных и рекомендуемых решений. Ссылаться на ключевые источники при предложении сложных или неочевидных решений.
* **Безопасность:**
    * Для задач, связанных с безопасностью (аутентификация, авторизация, обработка пользовательских данных, файловые операции, интеграции со сторонними сервисами), явно указывать потенциальные риски и предлагать конкретные способы их минимизации в соответствии с OWASP Top 10 и другими релевантными стандартами.

## 6. Модель Данных (MVP Focus, High-Level)

* **User (Пользователь)**
    * `id`: UUID (Primary Key)
    * `email`: String (Unique, Indexed)
    * `passwordHash`: String
    * `firstName`: String
    * `lastName`: String
    * `role`: Enum (Предприниматель, Сотрудник, Консьерж, Администратор)
    * `companyId`: UUID (ForeignKey to Company, nullable for Консьерж/Администратор)
    * `phone`: String (nullable)
    * `isEmailVerified`: Boolean (default: false)
    * `isActive`: Boolean (default: true)
    * `createdAt`: DateTime
    * `updatedAt`: DateTime
    * `resetPasswordToken`: String (nullable)
    * `resetPasswordExpires`: DateTime (nullable)

* **Company (Компания)**
    * `id`: UUID (Primary Key)
    * `name`: String
    * `inn`: String (nullable, Indexed)
    * `description`: Text (nullable)
    * `address`: String (nullable)
    * `ownerId`: UUID (ForeignKey to User - Предприниматель, который создал компанию)
    * `tariffPlanId`: UUID (ForeignKey to TariffPlan, nullable)
    * `subscriptionEndDate`: DateTime (nullable)
    * `createdAt`: DateTime
    * `updatedAt`: DateTime

* **Request (Запрос)**
    * `id`: UUID (Primary Key)
    * `title`: String
    * `description`: Text
    * `category`: String (e.g., "Юридические", "Финансы")
    * `status`: Enum ("Новый", "В работе", "Требует уточнения", "Ожидает ответа клиента", "Выполнен", "Отменен")
    * `priority`: Enum ("Низкая", "Средняя", "Высокая", nullable)
    * `desiredDueDate`: Date (nullable)
    * `budget`: String (nullable)
    * `expectedResult`: Text
    * `clientId`: UUID (ForeignKey to User - Предприниматель или Сотрудник)
    * `companyId`: UUID (ForeignKey to Company)
    * `conciergeId`: UUID (ForeignKey to User - Консьерж-менеджер, nullable)
    * `createdAt`: DateTime
    * `updatedAt`: DateTime

* **RequestFile (Файл Запроса)**
    * `id`: UUID (Primary Key)
    * `requestId`: UUID (ForeignKey to Request)
    * `fileName`: String
    * `fileUrl`: String (URL в облачном хранилище)
    * `fileSize`: Integer (bytes)
    * `mimeType`: String
    * `uploadedAt`: DateTime

* **Contractor (Подрядчик) - Упрощенная для MVP**
    * `id`: UUID (Primary Key)
    * `name`: String
    * `logoUrl`: String (nullable)
    * `shortDescription`: String
    * `specializations`: Array of Strings (e.g., ["Маркетинг", "SEO"])
    * `servicesDescription`: Text
    * `cases`: Text (описание кейсов)
    * `reviews`: Text (текст отзывов, добавленных админом)
    * `rating`: Float (nullable, управляется админом для MVP)
    * `isActive`: Boolean (default: true)
    * `createdAt`: DateTime
    * `updatedAt`: DateTime

* **DocumentTemplate (Шаблон Документа) - Упрощенная для MVP**
    * `id`: UUID (Primary Key)
    * `title`: String
    * `description`: String (nullable)
    * `category`: String (nullable)
    * `fileUrl`: String (URL статического файла)
    * `fileName`: String
    * `lastUpdatedAt`: DateTime (дата обновления файла админом)
    * `isActive`: Boolean (default: true)
    * `createdAt`: DateTime

* **TariffPlan (Тарифный План)**
    * `id`: UUID (Primary Key)
    * `name`: String (Unique)
    * `description`: Text
    * `priceMonthly`: Decimal
    * `priceYearly`: Decimal (nullable)
    * `features`: JSON (описание фич, например, `{"maxRequests": 10, "contractorAccess": "limited"}`)
    * `isActive`: Boolean (default: true)
    * `createdAt`: DateTime
    * `updatedAt`: DateTime

* **Payment (Платеж)**
    * `id`: UUID (Primary Key)
    * `userId`: UUID (ForeignKey to User)
    * `companyId`: UUID (ForeignKey to Company)
    * `tariffPlanId`: UUID (ForeignKey to TariffPlan, nullable for разовые)
    * `amount`: Decimal
    * `currency`: String (default: "RUB")
    * `status`: Enum ("Pending", "Succeeded", "Failed")
    * `paymentGateway`: String (e.g., "YooKassa")
    * `gatewayPaymentId`: String (ID платежа в шлюзе)
    * `createdAt`: DateTime
    * `updatedAt`: DateTime

* **Notification (Уведомление)**
    * `id`: UUID (Primary Key)
    * `userId`: UUID (ForeignKey to User)
    * `type`: Enum (e.g., "NewMessage", "RequestStatusChanged")
    * `message`: Text
    * `relatedEntityId`: UUID (nullable, e.g., ID запроса, ID сообщения)
    * `isRead`: Boolean (default: false)
    * `createdAt`: DateTime

* **ChatMessage (Сообщение в Чате)**
    * `id`: UUID (Primary Key)
    * `requestId`: UUID (ForeignKey to Request)
    * `senderId`: UUID (ForeignKey to User)
    * `messageText`: Text
    * `createdAt`: DateTime
    * `isReadByReceiver`: Boolean (default: false)
    * `fileUrl`: String (nullable, если в чате разрешены файлы)

## 7. API Спецификации (High-Level)

### 7.1. Общие принципы
* API должен быть реализован в стиле RESTful.
* Формат обмена данными: JSON.
* Все эндпоинты должны быть защищены и требовать аутентификации, кроме публичных (например, регистрация, вход, восстановление пароля).
* Использовать стандартные HTTP-методы (GET, POST, PUT, DELETE, PATCH).
* Использовать стандартные HTTP-статус коды для ответов.
* Предусмотреть пагинацию для списков, используя query-параметры `page` (номер страницы, начиная с 1, по умолчанию 1) и `limit` (количество элементов на странице, по умолчанию 10, максимум 100).
* Предусмотреть фильтрацию и сортировку для списков, где это необходимо. Для сортировки использовать `sortBy` (имя поля для сортировки) и `order` (значения 'asc' или 'desc').

### 7.2. Аутентификация API
* Использовать JWT (JSON Web Tokens).
* Access token должен иметь короткое время жизни (например, 15-30 минут).
* Refresh token должен иметь более длительное время жизни (например, 7-30 дней) и использоваться для обновления access token.
* Refresh token должен храниться безопасно (например, в httpOnly cookie).

### 7.3. Ключевые эндпоинты (группировка по модулям MVP)
* **Auth API (`/auth`)**
    * `POST /auth/register` (Регистрация Предпринимателя)
    * `POST /auth/login` (Вход)
    * `POST /auth/refresh-token` (Обновление токена)
    * `POST /auth/logout` (Выход)
    * `POST /auth/forgot-password`
    * `POST /auth/reset-password`
* **Users API (`/users`)**
    * `GET /users/me` (Получение данных текущего пользователя)
    * `PUT /users/me` (Обновление данных текущего пользователя)
    * `PUT /users/me/password` (Смена пароля)
* **Companies API (`/companies`)**
    * `GET /companies/my` (Получение данных компании текущего пользователя)
    * `PUT /companies/my` (Обновление данных компании)
    * `POST /companies/my/employees` (Приглашение сотрудника)
    * `GET /companies/my/employees` (Список сотрудников)
    * `DELETE /companies/my/employees/{employeeId}` (Удаление сотрудника)
* **Requests API (`/requests`)**
    * `POST /requests` (Создание запроса)
    * `GET /requests` (Список запросов для клиента/консьержа с фильтрами)
    * `GET /requests/{id}` (Детали запроса)
    * `PUT /requests/{id}` (Обновление запроса, изменение статуса консьержем)
    * `POST /requests/{id}/messages` (Отправка сообщения в чат)
    * `GET /requests/{id}/messages` (Получение сообщений чата)
* **Contractors API (`/contractors`) - Только GET для клиента**
    * `GET /contractors` (Список подрядчиков с фильтрами)
    * `GET /contractors/{id}` (Детали подрядчика)
* **DocumentTemplates API (`/document-templates`) - Только GET для клиента**
    * `GET /document-templates` (Список шаблонов с фильтрами)
    * `GET /document-templates/{id}/download` (Скачивание файла шаблона)
* **Tariffs API (`/tariffs`)**
    * `GET /tariffs` (Список доступных тарифов)
    * `POST /subscriptions` (Оформление подписки)
    * `GET /subscriptions/my` (Текущая подписка)
    * `DELETE /subscriptions/my` (Отмена подписки)
* **Payments API (`/payments`)**
    * `GET /payments/my` (История платежей)
    * `POST /payments/webhook` (Webhook от платежного шлюза)
* **Notifications API (`/notifications`)**
    * `GET /notifications` (Список уведомлений для текущего пользователя)
    * `POST /notifications/{id}/read` (Пометить уведомление как прочитанное)
* **Admin API (`/admin`) - Отдельный набор эндпоинтов для Администратора**
    * Управление пользователями (CRUD для Консьержей)
    * Управление подрядчиками (CRUD)
    * Управление шаблонами (CRUD)
    * Управление тарифами (CRUD)

## 8. Этапы Разработки и Приемка (MVP)

### 8.1. Ожидаемый результат MVP (Definition of Done for MVP)
MVP считается готовым, когда:
1.  Все функции, описанные в Разделе 4 данного ТЗ, реализованы и протестированы.
2.  Платформа развернута на тестовом/production окружении и доступна для ограниченного числа пользователей.
3.  Проведены базовые тесты безопасности и производительности.
4.  Подготовлена минимальная пользовательская документация (FAQ, инструкции для Консьерж-менеджеров).
5.  Обеспечена возможность сбора обратной связи от первых пользователей.
6.  Срок разработки не превысил 2 месяца.

### 8.2. Критерии приемки для отдельных функций
Для каждой функции из Раздела 4 должны быть определены конкретные сценарии использования (User Stories) и критерии приемки (Acceptance Criteria). ИИ-разработчик должен стремиться к тому, чтобы генерируемый код удовлетворял этим критериям.

**Пример User Story + Acceptance Criteria (для ИИ):**

* **User Story (Предприниматель):** "Как Предприниматель, я хочу иметь возможность зарегистрироваться на платформе, используя свой email и пароль, чтобы получить доступ к ее функциям."
* **Acceptance Criteria:**
    1.  Форма регистрации содержит поля: Email, Пароль, Повтор пароля, Имя, Фамилия, Название компании.
    2.  Валидация на стороне клиента и сервера проверяет корректность Email и сложность пароля (например, мин. 8 символов, наличие букв и цифр).
    3.  При успешной регистрации создается новая запись пользователя и компании в БД.
    4.  Пользователь автоматически аутентифицируется и перенаправляется на Дашборд.
    5.  (Опционально) На Email пользователя отправляется письмо с подтверждением регистрации.
    6.  При попытке регистрации с уже существующим Email выводится соответствующая ошибка.

Детальные User Stories и Acceptance Criteria для каждой функции будут предоставляться итерационно, начиная с ключевых функций Модуля Пользовательского Управления и Модуля Управления Запросами. ИИ может запрашивать их по мере продвижения по задачам.

### 8.3. Процесс Управления Задачами и Взаимодействие с ИИ
Для эффективного взаимодействия с ИИ-ассистентом и управления процессом разработки следует придерживаться следующих принципов и форматов постановки задач:

#### 8.3.1. Общие Принципы Взаимодействия
* **Отслеживание выполнения:** Выполненные задачи или подзадачи отмечаются как `[x]`.
* **Утверждение фаз:** Перед началом следующей крупной фазы разработки или модуля ИИ должен запросить одобрение пользователя (руководителя проекта).
* **Задачи для пользователя-разработчика:** Если в ходе работы ИИ возникают задачи, требующие выполнения человеком-разработчиком (например, настройка специфического окружения, получение API-ключей), ИИ должен четко сформулировать задачу в чате и ожидать подтверждения ее выполнения.
* **Отчет об изменениях:** Рядом с выполненной задачей или в комментарии к ней ИИ должен указывать список созданных или измененных файлов.
* **Планирование:** ИИ не должен отмечать будущие задачи как выполненные до получения явного запроса на их реализацию.
* **Структура и порядок:** Задачи будут предоставляться сгруппированными по фазам или модулям. ИИ должен следовать этому порядку, если не указано иное. При генерации новых подзадач ИИ должен использовать единообразное именование и структуру.
* **Документация и ресурсы:** При необходимости ИИ может добавлять ссылки на релевантную документацию или использованные ресурсы.
* **Блокировка задач:** Если задача заблокирована (например, ожиданием информации или выполнения другой задачи), ИИ должен четко указать причину блокировки и зависимости.
* **Проверка фаз:** Перед запросом на переход к следующей фазе ИИ должен убедиться в полноте выполнения всех задач текущей фазы.
* **Временные метки (опционально):** Для отслеживания прогресса ИИ может указывать примерное время начала и завершения работы над крупными задачами.
* **Комментарии и обоснования:** ИИ должен использовать комментарии в коде для сложных участков и может предоставлять краткие обоснования выбранных решений в чате или в описании задачи, если это необходимо.

#### 8.3.2. Формат Постановки Задач для ИИ
Каждая задача, передаваемая ИИ, должна стремиться к следующей структуре:
* **Контекст и Цель:** Краткое описание цели задачи (Что мы хотим достичь?) и ее контекста (Какая часть системы затрагивается? Какие есть зависимости от других модулей или задач?).
* **Ожидаемый Результат (Acceptance Criteria):** Четкое определение того, что считается успешным выполнением задачи (например, "сгенерирован код модуля X с покрытием unit-тестами не менее Y%", "создана и применена миграция схемы БД для сущности Z", "настроен CI/CD пайплайн, который выполняет сборку, линтинг и запуск тестов").
* **Технологические Указания (если необходимо уточнение сверх общего стека):** Указание конкретных технологий, библиотек, версий (если критично), паттернов проектирования, которые ИИ должен использовать для данной задачи.
* **Примеры (если применимо):** Небольшие примеры кода, структуры данных, ожидаемого формата API ответа или UI элемента.
* **Нефункциональные Требования (в контексте задачи):** Упоминание релевантных нефункциональных требований (производительность, безопасность, читаемость кода, логирование) для конкретной задачи.
* **Итеративность:** Для сложных и объемных задач ИИ может быть предложено разбить их на более мелкие подзадачи или генерировать решение по частям, запрашивая обратную связь и утверждение после каждого этапа.
* **Формат Вывода:** Указание желаемого формата вывода от ИИ (например, "предоставить код в виде отдельных файлов .ts с указанием их путей в проекте", "сгенерировать миграционный файл Prisma schema", "предоставить последовательность команд для Docker CLI").
* **Вопросы для Уточнения:** ИИ поощряется задавать уточняющие вопросы, если задача или ее часть недостаточно ясны.
* **Фокус на Безопасности (для релевантных задач):** Для задач, связанных с обработкой пользовательских данных, аутентификацией, авторизацией или внешними интеграциями, явно указывать на необходимость учета аспектов безопасности (например, "реализовать эндпоинт с учетом защиты от CSRF и XSS", "использовать параметризованные запросы к БД", "обеспечить валидацию всех входящих данных").
* **Документирование Кода:** Требование генерации комментариев к коду (TSDoc/JSDoc) для всех публичных функций, классов, методов и сложной или неочевидной логики.
* **Генерация Тестов:** Для большинства задач по генерации кода (особенно для бэкенд-логики) требовать также генерации соответствующих unit-тестов, стремясь к покрытию, указанному в разделе 5.2.
* **Указание на Файлы:** После выполнения задачи ИИ должен предоставить список всех созданных или значительно измененных файлов.

## 9. Приложения
*(На данном этапе отсутствуют. Могут быть добавлены позже: макеты UI, детальные диаграммы и т.д.)*

